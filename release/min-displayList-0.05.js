(function(){var t={},i=function(){!function(t){var i,e,n,r,o,a;t.add=function(t,i,n){if(i||n){var r;"[object Array]"===Object.prototype.toString.call(n)?r=n:(r=Array.prototype.slice.call(arguments,2),r||(r=[])),e.push([i,t,r])}else e.push(t)},t.after=function(t,i,e){e||(e="aft7491_"+a++),r[e]={step:Math.floor(1e3*t),fn:i,nextTime:0,remove:!0}},t.asap=function(t){this.add(t)},t.every=function(t,i,e){e||(e="t7491_"+a++),r[e]={step:Math.floor(1e3*t),fn:i,nextTime:0}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){if(!i){a=1,this.polyfill();var t,s;if("undefined"!=typeof window){var t=window.requestAnimationFrame,s=window.cancelRequestAnimationFrame;["","ms","moz","webkit","o"].forEach(function(i){t||(t=window[i+"RequestAnimationFrame"],s=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"])})}t||(t=function(t){return setTimeout(t,16)}),s||(s=function(t){clearTimeout(t)}),e=[],n={},r={},o=[];var h=0,f=function(){for(var i,a=(new Date).getTime();i=e.shift();)"[object Array]"===Object.prototype.toString.call(i)?i[1].apply(i[0],i[2]):i();for(var s=0;s<o.length;s++){var c=o[s];c()}for(var l in n)if(n.hasOwnProperty(l)){var u=n[l];u[0](u[1]),delete n[l]}for(var l in r)if(r.hasOwnProperty(l)){var u=r[l];u.nextTime<a&&(u.remove?u.nextTime>0?(u.fn(),delete r[l]):u.nextTime=a+u.step:(u.fn(),u.nextTime=a+u.step)),u.until&&u.until<a&&delete r[l]}t(f),h=a};f(),i=!0}}),t.once=function(t,i,e){n[t]=[i,e]},t.onFrame=function(t){o.push(t)},t.polyfill=function(){},t.removeFrameFn=function(t){var i=o.indexOf(t);return i>=0?(t._onRemove&&t._onRemove(),o.splice(i,1),!0):!1}}(this)},e=function(t,i,n,r,o,a,s,h){var f,c=this;if(!(c instanceof e))return new e(t,i,n,r,o,a,s,h);var l=[t,i,n,r,o,a,s,h];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){f=t.apply(c,l)}),"function"==typeof f){if(f._classInfo.name!=e._classInfo.name)return new f(t,i,n,r,o,a,s,h)}else if(f)return f;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,l)}):"function"==typeof c.init&&c.init.apply(c,l)};e._classInfo={name:"later"},e.prototype=new i;var n=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._data={m00:1,m01:0,m02:0,m03:0,m10:0,m11:1,m12:0,m13:0,m20:0,m21:0,m22:1,m23:0,m30:0,m31:0,m32:0,m33:1}}),t.m00=function(t){return"undefined"!=typeof t?(this._data.m00!=t&&(this._dirty=!0),this._data.m00=t,this):this._data.m00},t.m01=function(t){return"undefined"!=typeof t?(this._data.m01!=t&&(this._dirty=!0),this._data.m01=t,this):this._data.m01},t.m02=function(t){return"undefined"!=typeof t?(this._data.m02!=t&&(this._dirty=!0),this._data.m02=t,this):this._data.m02},t.m03=function(t){return"undefined"!=typeof t?(this._data.m03!=t&&(this._dirty=!0),this._data.m03=t,this):this._data.m03},t.m10=function(t){return"undefined"!=typeof t?(this._data.m10!=t&&(this._dirty=!0),this._data.m10=t,this):this._data.m10},t.m11=function(t){return"undefined"!=typeof t?(this._data.m11!=t&&(this._dirty=!0),this._data.m11=t,this):this._data.m11},t.m12=function(t){return"undefined"!=typeof t?(this._data.m12!=t&&(this._dirty=!0),this._data.m12=t,this):this._data.m12},t.m13=function(t){return"undefined"!=typeof t?(this._data.m13!=t&&(this._dirty=!0),this._data.m13=t,this):this._data.m13},t.m20=function(t){return"undefined"!=typeof t?(this._data.m20!=t&&(this._dirty=!0),this._data.m20=t,this):this._data.m20},t.m21=function(t){return"undefined"!=typeof t?(this._data.m21!=t&&(this._dirty=!0),this._data.m21=t,this):this._data.m21},t.m22=function(t){return"undefined"!=typeof t?(this._data.m22!=t&&(this._dirty=!0),this._data.m22=t,this):this._data.m22},t.m23=function(t){return"undefined"!=typeof t?(this._data.m23!=t&&(this._dirty=!0),this._data.m23=t,this):this._data.m23},t.m30=function(t){return"undefined"!=typeof t?(this._data.m30!=t&&(this._dirty=!0),this._data.m30=t,this):this._data.m30},t.m31=function(t){return"undefined"!=typeof t?(this._data.m31!=t&&(this._dirty=!0),this._data.m31=t,this):this._data.m31},t.m32=function(t){return"undefined"!=typeof t?(this._data.m32!=t&&(this._dirty=!0),this._data.m32=t,this):this._data.m32},t.m33=function(t){return"undefined"!=typeof t?(this._data.m33!=t&&(this._dirty=!0),this._data.m33=t,this):this._data.m33}}(this),function(t){var i;t.blend=function(t){if(this._scaleBlenders){var t=this._scaleBlendFn(),i=this._scaleBlenders[0],e=this._scaleBlenders[1];if("undefined"==typeof t)return;this.m00(i.m00()*(1-t)+e.m00()*t),this.m11(i.m11()*(1-t)+e.m11()*t),this.m22(i.m22()*(1-t)+e.m22()*t)}},t.blendScale=function(t,i){this._scaleBlenders=t,this._scaleBlendFn=i},t.copyFrom=function(t){var i=t._data;this._data.m00=i.m00,this._data.m01=i.m01,this._data.m02=i.m02,this._data.m03=i.m03,this._data.m10=i.m10,this._data.m11=i.m11,this._data.m12=i.m12,this._data.m13=i.m13,this._data.m20=i.m20,this._data.m21=i.m21,this._data.m22=i.m22,this._data.m23=i.m23,this._data.m30=i.m30,this._data.m31=i.m31,this._data.m32=i.m32,this._data.m33=i.m33},t.createCopy=function(){var t=this.createIdentity();return t.updateFromParams(this.m00(),this.m01(),this.m02(),this.m03(),this.m10(),this.m11(),this.m12(),this.m13(),this.m20(),this.m21(),this.m22(),this.m23(),this.m30(),this.m31(),this.m32(),this.m33()),t},t.createIdentity=function(){return r()},t.createThreeMatrix=function(){var t=new THREE.Matrix4;return t.set(this.m00(),this.m10(),this.m20(),this.m30(),this.m01(),this.m11(),this.m21(),this.m31(),this.m02(),this.m12(),this.m22(),this.m32(),this.m03(),this.m13(),this.m23(),this.m33()),t},t.createTransformCopy=function(){var t=r();return t.m30(this.m30()),t.m31(this.m31()),t.m32(this.m32()),t},t.det=function(){var t=this.m00(),i=this.m01(),e=this.m02(),n=this.m03(),r=this.m10(),o=this.m11(),a=this.m12(),s=this.m13(),h=this.m20(),f=this.m21(),c=this.m22(),l=this.m23(),u=this.m30(),d=this.m31(),y=this.m32(),m=this.m33(),p=t*o-r*i,_=t*f-h*i,x=t*d-u*i,v=r*f-h*o,g=r*d-u*o,w=h*d-u*f,I=e*s-a*n,z=e*l-c*n,C=e*m-y*n,M=a*l-c*s,b=a*m-y*s,P=c*m-y*l;return p*P-_*b+x*M+v*C-g*z+w*I},t.exactInverse=function(){var t=this.m00(),i=this.m01(),e=this.m02(),n=this.m03(),r=this.m10(),o=this.m11(),a=this.m12(),s=this.m13(),h=this.m20(),f=this.m21(),c=this.m22(),l=this.m23(),u=this.m30(),d=this.m31(),y=this.m32(),m=this.m33(),p=t*o-r*i,_=t*f-h*i,x=t*d-u*i,v=r*f-h*o,g=r*d-u*o,w=h*d-u*f,I=e*s-a*n,z=e*l-c*n,C=e*m-y*n,M=a*l-c*s,b=a*m-y*s,P=c*m-y*l,j=p*P-_*b+x*M+v*C-g*z+w*I;if(0!=j){var F=1/j;return this.m00((o*P-f*b+d*M)*F),this.m01((-i*P+f*C-d*z)*F),this.m02((i*b-o*C+d*I)*F),this.m03((-i*M+o*z-f*I)*F),this.m10((-r*P+h*b-u*M)*F),this.m11((t*P-h*C+u*z)*F),this.m12((-t*b+r*C-u*I)*F),this.m13((t*M-r*z+h*I)*F),this.m20((s*w-l*g+m*v)*F),this.m21((-n*w+l*x-m*_)*F),this.m22((n*g-s*x+m*p)*F),this.m23((-n*v+s*_-l*p)*F),this.m30((-a*w+c*g-y*v)*F),this.m31((e*w-c*x+y*_)*F),this.m32((-e*g+a*x-y*p)*F),this.m33((e*v-a*_+c*p)*F),this}},t.getCSSMatrix3D=function(){i=this.systemHas3D();var t=5;if(i){var e="matrix3d("+this.m00().toFixed(t)+", "+this.m01().toFixed(t)+", "+this.m02().toFixed(t)+", "+this.m03().toFixed(t)+","+this.m10().toFixed(t)+", "+this.m11().toFixed(t)+", "+this.m12().toFixed(t)+", "+this.m13().toFixed(t)+","+this.m20().toFixed(t)+", "+this.m21().toFixed(t)+", "+this.m22().toFixed(t)+", "+this.m23().toFixed(t)+","+this.m30().toFixed(t)+", "+this.m31().toFixed(t)+", "+this.m32().toFixed(t)+", "+this.m33().toFixed(t)+")";return e+";-webkit-transform:"+e+";-ms-transform:"+e+";-webkit-transform-origin:0 0;-ms-transform-origin:0 0;"}var e="matrix("+this.m00().toFixed(t)+", "+this.m01().toFixed(t)+", "+this.m10().toFixed(t)+", "+this.m11().toFixed(t)+", "+this.m30().toFixed(t)+", "+this.m31().toFixed(t)+")";return e+";-webkit-transform:"+e+";-ms-transform:"+e+";-webkit-transform-origin:0 0;-ms-transform-origin:0 0;"},t.getRotation2D=function(){var t,i=this.m00(),e=this.m01();return t=e>=0?Math.acos(i):-1*Math.acos(i)},t.getSVGTransform=function(){return"matrix("+this.m00().toFixed(5)+","+this.m01().toFixed(5)+","+this.m10().toFixed(5)+","+this.m11().toFixed(5)+","+this.m30().toFixed(5)+","+this.m31().toFixed(5)+")"},t.intersectPlane=function(t,i){var e=this.normalizeVector3D({x:this.m20(),y:this.m21(),z:this.m22()}),n={x:this.m30()-t.x,y:this.m31()-t.y,z:this.m32()-t.z},r=n.x*e.x+n.y*e.y+n.z*e.z,o={x:i.x-t.x,y:i.y-t.y,z:i.z-t.z},a=o.x*e.x+o.y*e.y+o.z*e.z;if(Math.abs(r)>0&&Math.abs(a)>0){var s=r/a;if(Math.abs(s)>0){var h={x:t.x+o.x*s,y:t.y+o.y*s,z:t.z+o.z*s};return h}}},t.inverse=function(){var t=this.m00(),i=this.m01(),e=this.m02(),n=this.m03(),r=this.m10(),o=this.m11(),a=this.m12(),s=this.m13(),h=this.m20(),f=this.m21(),c=this.m22(),l=this.m23(),u=this.m30(),d=this.m31(),y=this.m32(),m=this.m33(),p=t*o-r*i,_=t*f-h*i,x=t*d-u*i,v=r*f-h*o,g=r*d-u*o,w=h*d-u*f,I=e*s-a*n,z=e*l-c*n,C=e*m-y*n,M=a*l-c*s,b=a*m-y*s,P=c*m-y*l,j=p*P-_*b+x*M+v*C-g*z+w*I;if(0!=j){var F=1/j;return this.m00((o*P-f*b+d*M)*F),this.m01((-i*P+f*C-d*z)*F),this.m02((i*b-o*C+d*I)*F),this.m03((-i*M+o*z-f*I)*F),this.m10((-r*P+h*b-u*M)*F),this.m11((t*P-h*C+u*z)*F),this.m12((-t*b+r*C-u*I)*F),this.m13((t*M-r*z+h*I)*F),this.m20((s*w-l*g+m*v)*F),this.m21((-n*w+l*x-m*_)*F),this.m22((n*g-s*x+m*p)*F),this.m23((-n*v+s*_-l*p)*F),this.m30((-a*w+c*g-y*v)*F),this.m31((e*w-c*x+y*_)*F),this.m32((-e*g+a*x-y*p)*F),this.m33((e*v-a*_+c*p)*F),this}},t.isValidMatrix=function(){var t=this._data;return isNaN(t.m00)?!1:isNaN(t.m01)?!1:isNaN(t.m02)?!1:isNaN(t.m03)?!1:isNaN(t.m10)?!1:isNaN(t.m11)?!1:isNaN(t.m12)?!1:isNaN(t.m13)?!1:isNaN(t.m20)?!1:isNaN(t.m21)?!1:isNaN(t.m22)?!1:isNaN(t.m23)?!1:isNaN(t.m30)?!1:isNaN(t.m31)?!1:isNaN(t.m32)?!1:isNaN(t.m33)?!1:!0},t.log=function(){console.log(this._data)},t.matMul=function(t){var i=this.m00(),e=this.m01(),n=this.m02(),r=this.m03(),o=this.m10(),a=this.m11(),s=this.m12(),h=this.m13(),f=this.m20(),c=this.m21(),l=this.m22(),u=this.m23(),d=this.m30(),y=this.m31(),m=this.m32(),p=this.m33(),_=t.m00(),x=t.m01(),v=t.m02(),g=t.m03(),w=t.m10(),I=t.m11(),z=t.m12(),C=t.m13(),M=t.m20(),b=t.m21(),P=t.m22(),j=t.m23(),F=t.m30(),R=t.m31(),L=t.m32(),T=t.m33();return this.updateFromParams(i*_+o*x+f*v+d*g,e*_+a*x+c*v+y*g,n*_+s*x+l*v+m*g,r*_+h*x+u*v+p*g,i*w+o*I+f*z+d*C,e*w+a*I+c*z+y*C,n*w+s*I+l*z+m*C,r*w+h*I+u*z+p*C,i*M+o*b+f*P+d*j,e*M+a*b+c*P+y*j,n*M+s*b+l*P+m*j,r*M+h*b+u*P+p*j,i*F+o*R+f*L+d*T,e*F+a*R+c*L+y*T,n*F+s*R+l*L+m*T,r*F+h*R+u*L+p*T),this},t.normalize=function(){this.copyFrom(new r)},t.normalizeVector3D=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0==i||isNaN(i)?{x:1,y:0,z:0}:{x:t.x/i,y:t.y/i,z:t.z/i}},t.projectVector=function(t){var i=this.m00(),e=this.m01(),n=this.m02(),r=this.m03(),o=this.m10(),a=this.m11(),s=this.m12(),h=this.m13(),f=this.m20(),c=this.m21(),l=this.m22(),u=this.m23(),d=this.m30(),y=this.m31(),m=this.m32(),p=this.m33();return{x:i*t.x+o*t.y+f*t.z+d*t.w,y:e*t.x+a*t.y+c*t.z+y*t.w,z:n*t.x+s*t.y+l*t.z+m*t.w,w:r*t.x+h*t.y+u*t.z+p*t.w}},t.rotate=function(t,i){var t=this.normalizeVector3D(t),e=t.x,n=t.y,r=t.z,o=Math.cos(i),a=Math.sin(i);this.updateFromParams(o+e*e*(1-o),n*e*(1-o)+r*a,r*e*(1-o)-n*a,0,n*e*(1-o)-r*a,o+n*n*(1-o),r*n*(1-o)+e*a,0,r*e*(1-o)+n*a,n*r*(1-o)-e*a,o+r*r*(1-o),0,0,0,0,1),0==i&&(console.log("*** angle is zero****"),console.log(this._data))},t.scale=function(t){return this.updateFromParams(t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1),this},t.screenProjection=function(t,i){var e=this.projectVector(t);if(!i.d)return r=e.x,o=e.y,{x:r,y:o};var n=i.d-e.z,r=e.x-(i.cx||500),o=e.y-(i.cy||500);return n>0?{x:i.cx+r*i.d/n,y:i.cy+o*i.d/n}:void 0},t.setDomContext=function(t){t.setTransform(this.m00(),this.m01(),this.m10(),this.m11(),this.m30(),this.m31())},t.systemHas3D=function(t){if("undefined"!=typeof i)return i;if("undefined"==typeof window)return!1;if(!window.getComputedStyle)return!1;var e,n=document.createElement("p"),r={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(n,null);for(var t in r)void 0!==n.style[t]&&(n.style[t]="translate3d(1px,1px,1px)",e=window.getComputedStyle(n).getPropertyValue(r[t]));return document.body.removeChild(n),void 0!==e&&e.length>0&&"none"!==e},t.translate=function(t){this.updateFromParams(1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1)},t.updateFromParams=function(){var t=this._data,i=0;t.m00=arguments[i++],t.m01=arguments[i++],t.m02=arguments[i++],t.m03=arguments[i++],t.m10=arguments[i++],t.m11=arguments[i++],t.m12=arguments[i++],t.m13=arguments[i++],t.m20=arguments[i++],t.m21=arguments[i++],t.m22=arguments[i++],t.m23=arguments[i++],t.m30=arguments[i++],t.m31=arguments[i++],t.m32=arguments[i++],t.m33=arguments[i++]}}(this)},r=function(t,i,e,n,o,a,s,h){var f,c=this;if(!(c instanceof r))return new r(t,i,e,n,o,a,s,h);var l=[t,i,e,n,o,a,s,h];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){f=t.apply(c,l)}),"function"==typeof f){if(f._classInfo.name!=r._classInfo.name)return new f(t,i,e,n,o,a,s,h)}else if(f)return f;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,l)}):"function"==typeof c.init&&c.init.apply(c,l)};r._classInfo={name:"Matrix3D"},r.prototype=new n;var o=function(){!function(t){t.adjustDivSize=function(){var t=this.myDiv,i=this.length();t._dom.style.width=i+"px",t._dom.style.height=(this.options.weight||this.weight||3)+"px"},t.adjustStyleProps=function(){var t=this.length();if(t>0){var i=this.ex-this.sx,e=-1*(this.ey-this.sy),n=i/t,r=e/t,o=this.sx,a=this.sy,s=n.toFixed(5)+","+(-1*r).toFixed(5)+",";s+=r.toFixed(5)+","+n.toFixed(5)+","+o.toFixed(5)+","+a.toFixed(5);var h="transform-origin:0 0;-webkit-transform-origin:0 0; -ms-transform-origin: 0 0;-ms-transform: matrix("+s+"); ";h+="-webkit-transform: matrix("+s+"); ",h+="transform: matrix("+s+");";var f=this.options.bgColor||"blue",c=h+";background-color:"+f+";height:"+this.weight+"px;position:absolute;left:0px;top:0px;width:"+t+"px;";this.myDiv.attr({style:c})}},t.attr=function(t){return this.myDiv.attr(t)},t.getElem=function(){return this.myDiv},t.hide=function(){this.myDiv.hide()},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,e,n,r){this.sx=t,this.sy=i,this.ex=e,this.ey=n;var o=_e("div");o.absolute().x(0).y(0),this.myDiv=o,this.options=r||{},this.weight=r.weight||3,this.adjustDivSize(),this.adjustStyleProps()}),t.length=function(){var t=this.ex-this.sx,i=this.ey-this.sy;return Math.sqrt(t*t+i*i)},t.moveTo=function(t,i,e,n){this.sx=t,this.sy=i,this.ex=e,this.ey=n,this.adjustDivSize(),this.adjustStyleProps()},t.show=function(){this.myDiv.show()}}(this)},a=function(t,i,e,n,r,o,s,h){var f,c=this;if(!(c instanceof a))return new a(t,i,e,n,r,o,s,h);var l=[t,i,e,n,r,o,s,h];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){f=t.apply(c,l)}),"function"==typeof f){if(f._classInfo.name!=a._classInfo.name)return new f(t,i,e,n,r,o,s,h)}else if(f)return f;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,l)}):"function"==typeof c.init&&c.init.apply(c,l)};a._classInfo={name:"drawLine"},a.prototype=new o;var s=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.frameClear=function(){},t.getDom=function(){return this._dom},t.getHeight=function(){return this._height},t.getWidth=function(){return this._width},t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.id=function(){return this._id||(this._id="sface"+this.guid()),this._id},t.registerRenderer=function(t,i,e,n){return this.isObject(i)&&!this.isFunction(i)?void(this._renderFns[t]=i):void(this._renderFns[t]={start:i,refresh:e,end:n})},t.removeObject=function(t,i){var e=t.renderClass(),n=this._renderFns;if(n[e]){var r=n[e];t.setRenderScope(this.id());var o=t.getRenderData(this.id());r.end(t,i,o),o.state=3,t.setRenderScope(null),t.removeFromDisplay(i.id(),i)}},t.render=function(t,i){var e=t.renderClass(),n=this._renderFns;if(n[e]){var r=n[e];t.setRenderScope(this.id());var o=t.getRenderData(this.id());"undefined"==typeof o.state&&(o.state=1),t.askToRemove(this.id())&&(r.end(t,i,o),o.state=3,t.askToRemove(this.id(),!1)),1==o.state&&t&&t._model&&t._model.isFulfilled()&&(r.start(t,i,o),t.projectToCamera(i.getCamera()),r.refresh(t,i,o)),2==o.state&&(t.projectToCamera(i.getCamera()),r.refresh(t,i,o)),t.setRenderScope(null)}},t.restartObject=function(t,i,e){var n=e||t.renderClass(),r=this._renderFns;if(r[n]){var o=r[n];t.setRenderScope(this.id());var a,s=t.getRenderData(this.id());s.viewG&&(a=s.viewG),o.end(t,i,s),s.state=1,t.setRenderScope(null)}},t.standardHandleRenderers=function(t){this.registerRenderer(t,function(t,i,e){if(t.areHandlesVisible()){var n=(i.getCamera(),_e(i.getSurface().getDom()));if(!e.rightBottom){var r="M24.249,15.499c-0.009,4.832-3.918,8.741-8.75,8.75c-2.515,0-4.768-1.064-6.365-2.763l2.068-1.442l-7.901-3.703l0.744,8.694l2.193-1.529c2.244,2.594,5.562,4.242,9.26,4.242c6.767,0,12.249-5.482,12.249-12.249H24.249zM15.499,6.75c2.516,0,4.769,1.065,6.367,2.764l-2.068,1.443l7.901,3.701l-0.746-8.693l-2.192,1.529c-2.245-2.594-5.562-4.245-9.262-4.245C8.734,3.25,3.25,8.734,3.249,15.499H6.75C6.758,10.668,10.668,6.758,15.499,6.75z",o=c(50,50,30,r);if(e.rotIcon=o,e.topBar=n.div("handle"),e.leftBar=n.div("handle"),e.bottomBar=n.div("handle"),e.rightBottom=n.div("handle"),e.rightMiddle=n.div("handle"),e.bottomMiddle=n.div("handle"),e.rightTop=n.div("handle"),e.rotCenter=n.div("handle"),e.rightBar=a(100,100,500,100,{bgColor:"red",weight:4}),n.add(e.rightBar.getElem()),e.rightBar.getElem().addClass("handle"),t.rotatableFor(e.rotIcon,i),t.resizeableWidthFor(e.rightMiddle),t.resizeableWidthFor(e.rightBar.getElem()),t.resizeableHeightFor(e.bottomMiddle),t.resizeableHeightFor(e.bottomBar),t.resizeableFor(e.rightBottom),t.handleRotationCenter(e.rotCenter),e.crossLine=a(100,100,500,100,{bgColor:"red",weight:10}),n.add(e.crossLine.getElem()),t.rotatableFor(e.crossLine.getElem(),i),n.add(o.getElem()),o.getElem().addClass("glow"),t.parent()){var s=t.parent();s.on("remove",function(){s._removedItem==t&&(e.rotCenter.hide(),e.topBar.hide(),e.leftBar.hide(),e.rightBar.hide(),e.bottomBar.hide(),e.rightBottom.hide(),e.rightMiddle.hide(),e.bottomMiddle.hide(),e.rightTop.hide(),e.crossLine.hide(),e.rotIcon.hide())})}}}},function(t,i,e){if(!t.areHandlesVisible())return e._handlesSet&&(e.rotCenter.hide(),e.topBar.hide(),e.leftBar.hide(),e.rightBar.hide(),e.bottomBar.hide(),e.rightBottom.hide(),e.rightMiddle.hide(),e.bottomMiddle.hide(),e.rightTop.hide(),e.crossLine.hide(),e.rotIcon.hide()),void(e._handlesSet=!1);e._handlesSet||(e.rotCenter.show(),e.topBar.show(),e.leftBar.show(),e.rightBar.show(),e.bottomBar.show(),e.rightBottom.show(),e.rightMiddle.show(),e.bottomMiddle.show(),e.rightTop.show(),e.crossLine.show(),e.rotIcon.show()),e._handlesSet=!0;var n=(i.getCamera(),i.getSurface()),o=(_e(i.getSurface().getDom()),1e3),a=n.getWidth(),s=n.getHeight();e.rightBottom.show(),e.rightTop.show();var h=t.getRenderMatrix().createCopy(),f=r(),c=h.m00();b=h.m10();var l=Math.sqrt(c*c+b*b);if(0!==l){e.crossLine.show(),h=t.getRenderMatrix().createCopy();{h.projectVector({x:t.w()/2,y:0,z:0,w:1}),h.projectVector({x:t.w()/2,y:t.h()*-.3,z:0,w:1})}h=t.getRenderMatrix().createCopy();var u=h.screenProjection({x:t.w(),y:0,z:0,w:1},{d:o,cx:a/2,cy:s/2}),d=h.screenProjection({x:t.w(),y:t.h(),z:0,w:1},{d:o,cx:a/2,cy:s/2}),y=h.screenProjection({x:t.w()/2,y:0,z:0,w:1},{d:o,cx:a/2,cy:s/2}),m=h.screenProjection({x:t.w()/2,y:t.h()*-.3,z:0,w:1},{d:o,cx:a/2,cy:s/2});e.crossLine.moveTo(y.x,y.y,m.x,m.y);var p=20*(1/l);f.translate({x:t.w(),y:t.h(),z:0}),h.matMul(f),e.rightBottom.attr({style:"transform-origin: 0 0;width:"+p+"px;height:"+p+"px;transform:"+h.getCSSMatrix3D()}),h=t.getRenderMatrix().createCopy(),f=r(),f.translate({x:t.w(),y:0,z:0}),h.matMul(f),e.rotIcon.moveTo(h.m30(),h.m31()),h=t.getRenderMatrix().createCopy();var _=h.screenProjection({x:t.w(),y:0,z:0,w:1},{d:o,cx:a/2,cy:s/2});e.rotIcon.moveTo(_.x,_.y,30),h=t.getRenderMatrix().createCopy(),f=r(),f.translate({x:t.w(),y:t.h()/2-.5*p,z:0}),h.matMul(f),e.rightMiddle.attr({style:"transform-origin: 0 0;width:"+p+"px;height:"+p+"px;transform:"+h.getCSSMatrix3D()}),h=t.getRenderMatrix().createCopy(),f=r(),f.translate({x:t.w()*t.ri()-.5*p,y:t.h()*t.rj()-.5*p,z:0}),h.matMul(f),e.rotCenter.attr({style:"border-radius:30px;background-color:red;transform-origin: 0 0;width:"+p+"px;height:"+p+"px;transform:"+h.getCSSMatrix3D()}),h=t.getRenderMatrix().createCopy(),f=r(),f.translate({x:t.w()/2-.5*p,y:t.h(),z:0}),h.matMul(f),e.bottomMiddle.attr({style:"transform-origin: 0 0;width:"+p+"px;height:"+p+"px;transform:"+h.getCSSMatrix3D()}),h=t.getRenderMatrix().createCopy(),e.topBar.attr({style:"background:none;border-color:red;border-width:4px; border-style:solid; transform-origin: 0 0;width:"+t.w()+"px;height:"+.2*p+"px;transform:"+h.getCSSMatrix3D()}),h=t.getRenderMatrix().createCopy(),e.leftBar.attr({style:"background:none;border-color:red;border-width:4px; border-style:solid; transform-origin: 0 0;width:"+.2*p+"px;height:"+t.h()+"px;transform:"+h.getCSSMatrix3D()}),h=t.getRenderMatrix().createCopy(),f=r(),f.translate({x:0,y:t.h(),z:0}),h.matMul(f),e.bottomBar.attr({style:"background:none;border-color:red;border-width:4px; border-style:solid; transform-origin: 0 0;width:"+t.w()+"px;height:"+.2*p+"px;transform:"+h.getCSSMatrix3D()}),e.rightBar.moveTo(u.x,u.y,d.x,d.y)}},function(t,i,e){i.getCamera(),_e(i.getSurface().getDom());e.rightBottom&&(e.rotCenter.hide(),e.topBar.hide(),e.leftBar.hide(),e.rightBar.hide(),e.bottomBar.hide(),e.rightBottom.hide(),e.rightMiddle.hide(),e.bottomMiddle.hide(),e.rightTop.hide(),e.crossLine.hide(),e.rotIcon.hide())})},t.startObject=function(t){var i=t.renderClass(),e=this._renderFns;if(e[i]){{e[i]}t.setRenderScope(this.id());var n=t.getRenderData(this.id());n.state=1,t.setRenderScope(null)}},t.svgGroupHandles=function(t){this.registerRenderer(t,function(t,i,e){var n=i.getSurface();if(!e.rotIcon){var r=n.getSvg(),o={stroke:"blue","stroke-width":2},a={fill:"blue",cx:0,cy:0,cursor:"pointer","class":"svghandle",r:56};e.rotLine=r.line("handle",o),e.rotIcon=r.circle("",a),t.groupRotationHandler(e.rotIcon,i),e.topLine=r.line("",o),e.rightLine=r.line("",o),e.bottomLine=r.line("",o),e.leftLine=r.line("",o),t.resizeableHeightFor(e.bottomLine);var s=r.circle();s.attr({fill:"blue",cx:0,cy:0,cursor:"pointer",r:56}),e.resizeIcon=s,t.groupResizeHandler(e.resizeIcon,i);var h=r.circle();h.attr({fill:"blue",cx:0,cy:0,cursor:"pointer",r:56}),e.resizeIconRt=h,t.groupResizeHandler(e.resizeIconRt,i,{i:0,j:1});var f=r.circle();f.attr({fill:"blue",cx:0,cy:0,cursor:"pointer",r:56}),e.resizeIconLt=f,t.groupResizeHandler(e.resizeIconLt,i,{i:1,j:1});var c=r.circle();if(c.attr({fill:"blue",cx:0,cy:0,cursor:"pointer",r:56}),e.resizeIconLb=c,t.groupResizeHandler(e.resizeIconLb,i,{i:1,j:0}),e.resizeBottom=r.circle("",a),t.resizeableHeightFor(e.resizeBottom,i),e.resizeLeft=r.circle("",a),t.resizeableWidthFor(e.resizeLeft,i,{inverse:!0}),e.resizeRight=r.circle("",a),t.resizeableWidthFor(e.resizeRight,i),t.parent()){var l=t.parent();l.on("remove",function(){l._removedItem==t&&(e.rotIcon.remove(),e.rotLine.remove(),e.resizeIcon.remove(),e.topLine.remove(),e.rightLine.remove(),e.bottomLine.remove(),e.leftLine.remove(),e.resizeBottom.remove(),e.resizeLeft.remove(),e.resizeRight.remove(),e.resizeIconRt.remove(),e.resizeIconLt.remove(),e.resizeIconLb.remove())})}}},function(t,i,e){e._handlesSet||(e.rotIcon.show(),e.rotLine.show(),e.topLine.show(),e.rightLine.show(),e.bottomLine.show(),e.leftLine.show(),e.resizeIcon.show(),e.resizeBottom.show(),e.resizeLeft.show(),e.resizeRight.show(),e.resizeIconRt.show(),e.resizeIconLt.show(),e.resizeIconLb.show()),e._handlesSet=!0;var n=(i.getCamera(),i.getSurface()),o=(_e(i.getSurface().getDom()),1e3),a=n.getWidth(),s=n.getHeight(),h=t.getViewMatrix(i.getCamera()).createCopy(),f=(r(),h.m00());b=h.m10();var c=Math.sqrt(f*f+b*b);if(0!==c){h=t.getViewMatrix(i.getCamera()).createCopy();var l=function(t,i){return h.screenProjection({x:t,y:i,z:0,w:1},{d:o,cx:a/2,cy:s/2})},u=l(t.w()/2,0),d=l(t.w()/2,-20/c),y=l(0,0),m=l(t.w(),0),p=l(t.w(),t.h()),_=l(0,t.h()),x=l(t.w()/2,t.h()),v=l(t.w(),t.h()/2),g=l(0,t.h()/2);e.rotIcon.attr({r:6,cx:d.x,cy:d.y}),e.resizeIcon.attr({r:6,cx:p.x,cy:p.y}),e.resizeIconRt.attr({r:6,cx:m.x,cy:m.y}),e.resizeIconLt.attr({r:6,cx:y.x,cy:y.y}),e.resizeIconLb.attr({r:6,cx:_.x,cy:_.y}),e.resizeBottom.attr({r:6,cx:x.x,cy:x.y}),e.resizeLeft.attr({r:6,cx:g.x,cy:g.y}),e.resizeRight.attr({r:6,cx:v.x,cy:v.y}),e.rotLine.attr({x1:u.x,y1:u.y,x2:d.x,y2:d.y}),e.topLine.attr({x1:y.x,y1:y.y,x2:m.x,y2:m.y}),e.rightLine.attr({x1:m.x,y1:m.y,x2:p.x,y2:p.y}),e.bottomLine.attr({x1:_.x,y1:_.y,x2:p.x,y2:p.y}),e.leftLine.attr({x1:y.x,y1:y.y,x2:_.x,y2:_.y})}},function(t,i,e){e.rotIcon&&(e.rotIcon.hide(),e.rotLine.hide(),e.resizeIcon.hide(),e.topLine.hide(),e.rightLine.hide(),e.bottomLine.hide(),e.leftLine.hide(),e.resizeBottom.hide(),e.resizeLeft.hide(),e.resizeRight.hide(),e.resizeIconRt.hide(),e.resizeIconLt.hide(),e.resizeIconLb.hide(),e._handlesSet=!1)})},t.svgHandleRenderers=function(t){this.registerRenderer(t,function(t,i,e){if(t.areHandlesVisible()){var n=i.getSurface();if(!e.rotIcon){var r=n.getSvg(),o={stroke:"blue","stroke-width":2},a={fill:"blue",cx:0,cy:0,cursor:"pointer","class":"svghandle",r:56};e.rotLine=r.line("handle",o),e.rotIcon=r.circle("",a),e.rotIcon.addClass("svghandle"),t.rotatableFor(e.rotIcon,i),e.topLine=r.line("",o),e.rightLine=r.line("",o),e.bottomLine=r.line("",o),e.leftLine=r.line("",o),t.resizeableHeightFor(e.bottomLine);var s=r.circle();if(s.attr({fill:"blue",cx:0,cy:0,cursor:"pointer",r:56}),e.resizeIcon=s,t.resizeableFor(e.resizeIcon,i),e.resizeBottom=r.circle("",a),t.resizeableHeightFor(e.resizeBottom,i),e.resizeLeft=r.circle("",a),t.resizeableWidthFor(e.resizeLeft,i,{inverse:!0}),e.resizeRight=r.circle("",a),t.resizeableWidthFor(e.resizeRight,i),t.parent()){var h=t.parent();h.on("remove",function(){h._removedItem==t&&(e.rotIcon.remove(),e.rotLine.remove(),e.resizeIcon.remove(),e.topLine.remove(),e.rightLine.remove(),e.bottomLine.remove(),e.leftLine.remove(),e.resizeBottom.remove(),e.resizeLeft.remove(),e.resizeRight.remove())})}}}},function(t,i,e){if(!t.areHandlesVisible())return e._handlesSet&&(e.rotIcon.hide(),e.rotLine.hide(),e.resizeIcon.hide(),e.topLine.hide(),e.rightLine.hide(),e.bottomLine.hide(),e.leftLine.hide(),e.resizeBottom.hide(),e.resizeLeft.hide(),e.resizeRight.hide()),void(e._handlesSet=!1);e._handlesSet||(e.rotIcon.show(),e.rotLine.show(),e.topLine.show(),e.rightLine.show(),e.bottomLine.show(),e.leftLine.show(),e.resizeIcon.show(),e.resizeBottom.show(),e.resizeLeft.show(),e.resizeRight.show()),e._handlesSet=!0;var n=(i.getCamera(),i.getSurface()),o=(_e(i.getSurface().getDom()),1e3),a=n.getWidth(),s=n.getHeight(),h=t.getRenderMatrix().createCopy(),f=(r(),h.m00());b=h.m10();var c=Math.sqrt(f*f+b*b);if(0!==c){h=t.getRenderMatrix().createCopy();var l=function(t,i){return h.screenProjection({x:t,y:i,z:0,w:1},{d:o,cx:a/2,cy:s/2})},u=l(t.w()/2,0),d=l(t.w()/2,-20/c),y=l(0,0),m=l(t.w(),0),p=l(t.w(),t.h()),_=l(0,t.h()),x=l(t.w()/2,t.h()),v=l(t.w(),t.h()/2),g=l(0,t.h()/2);e.rotIcon.attr({r:6,cx:d.x,cy:d.y}),e.resizeIcon.attr({r:6,cx:p.x,cy:p.y}),e.resizeBottom.attr({r:6,cx:x.x,cy:x.y}),e.resizeLeft.attr({r:6,cx:g.x,cy:g.y}),e.resizeRight.attr({r:6,cx:v.x,cy:v.y}),e.rotLine.attr({x1:u.x,y1:u.y,x2:d.x,y2:d.y}),e.topLine.attr({x1:y.x,y1:y.y,x2:m.x,y2:m.y}),e.rightLine.attr({x1:m.x,y1:m.y,x2:p.x,y2:p.y}),e.bottomLine.attr({x1:_.x,y1:_.y,x2:p.x,y2:p.y}),e.leftLine.attr({x1:y.x,y1:y.y,x2:_.x,y2:_.y})}},function(t,i,e){e.resizeLeft.hide(),e.resizeRight.hide(),e.rotIcon.hide(),e.topLine.hide(),e.rightLine.hide(),e.bottomLine.hide(),e.resizeBottom.hide(),e.resizeIcon.hide(),e.leftLine.hide()})},t.svgHandles=function(t){this.registerRenderer(t,function(t,i,e){if(t.areHandlesVisible()){var n=i.getSurface();if(!e.rotIcon){var r=n.getSvg(),o={stroke:"blue","stroke-width":2},a={fill:"blue",stroke:"white",cx:0,cy:0,"stoke-width":1,cursor:"pointer","class":"svghandle",r:56};e.rotLine=r.line("handle",o),e.rotIcon=r.circle("",a),t.rotatableFor(e.rotIcon,i),e.topLine=r.line("",o),e.rightLine=r.line("",o),e.bottomLine=r.line("",o),e.leftLine=r.line("",o),t.resizeableHeightFor(e.bottomLine);var s=r.circle();s.attr(a),e.resizeIcon=s,t.resizeableFor(e.resizeIcon,i);var h=r.circle();h.attr(a),e.resizeIconRt=h,t.resizeableFor(e.resizeIconRt,i,{i:0,j:1});var f=r.circle();f.attr(a),e.resizeIconLt=f,t.resizeableFor(e.resizeIconLt,i,{i:1,j:1});var c=r.circle();if(c.attr(a),e.resizeIconLb=c,t.resizeableFor(e.resizeIconLb,i,{i:1,j:0}),e.resizeBottom=r.circle("",a),t.resizeableHeightFor(e.resizeBottom,i),e.resizeLeft=r.circle("",a),t.resizeableWidthFor(e.resizeLeft,i,{inverse:!0}),e.resizeRight=r.circle("",a),t.resizeableWidthFor(e.resizeRight,i),t.parent()){var l=t.parent();l.on("remove",function(){l._removedItem==t&&(e.rotIcon.remove(),e.rotLine.remove(),e.resizeIcon.remove(),e.topLine.remove(),e.rightLine.remove(),e.bottomLine.remove(),e.leftLine.remove(),e.resizeBottom.remove(),e.resizeLeft.remove(),e.resizeRight.remove(),e.resizeIconRt.remove(),e.resizeIconLt.remove(),e.resizeIconLb.remove())})}}}},function(t,i,e){if(!t.areHandlesVisible())return e._handlesSet&&(e.rotIcon.hide(),e.rotLine.hide(),e.resizeIcon.hide(),e.topLine.hide(),e.rightLine.hide(),e.bottomLine.hide(),e.leftLine.hide(),e.resizeBottom.hide(),e.resizeLeft.hide(),e.resizeRight.hide(),e.resizeIconRt.hide(),e.resizeIconLt.hide(),e.resizeIconLb.hide()),void(e._handlesSet=!1);e._handlesSet||(e.rotIcon.show(),e.rotLine.show(),e.topLine.show(),e.rightLine.show(),e.bottomLine.show(),e.leftLine.show(),e.resizeIcon.show(),e.resizeBottom.show(),e.resizeLeft.show(),e.resizeRight.show(),e.resizeIconRt.show(),e.resizeIconLt.show(),e.resizeIconLb.show()),e._handlesSet=!0;var n=(i.getCamera(),i.getSurface()),o=(_e(i.getSurface().getDom()),1e3),a=n.getWidth(),s=n.getHeight(),h=t.getViewMatrix(i.getCamera()).createCopy(),f=(r(),h.m00()),c=h.m10(),l=Math.sqrt(f*f+c*c);if(0!==l){h=t.getViewMatrix(i.getCamera()).createCopy();var u=function(t,i){return h.screenProjection({x:t,y:i,z:0,w:1},{d:o,cx:a/2,cy:s/2})},d=u(t.w()/2,0),y=u(t.w()/2,-20/l),m=u(0,0),p=u(t.w(),0),_=u(t.w(),t.h()),x=u(0,t.h()),v=u(t.w()/2,t.h()),g=u(t.w(),t.h()/2),w=u(0,t.h()/2);e.rotIcon.attr({r:6,cx:y.x,cy:y.y}),e.resizeIcon.attr({r:6,cx:_.x,cy:_.y}),e.resizeIconRt.attr({r:6,cx:p.x,cy:p.y}),e.resizeIconLt.attr({r:6,cx:m.x,cy:m.y}),e.resizeIconLb.attr({r:6,cx:x.x,cy:x.y}),e.resizeBottom.attr({r:6,cx:v.x,cy:v.y}),e.resizeLeft.attr({r:6,cx:w.x,cy:w.y}),e.resizeRight.attr({r:6,cx:g.x,cy:g.y}),e.rotLine.attr({x1:d.x,y1:d.y,x2:y.x,y2:y.y}),e.topLine.attr({x1:m.x,y1:m.y,x2:p.x,y2:p.y}),e.rightLine.attr({x1:p.x,y1:p.y,x2:_.x,y2:_.y}),e.bottomLine.attr({x1:x.x,y1:x.y,x2:_.x,y2:_.y}),e.leftLine.attr({x1:m.x,y1:m.y,x2:x.x,y2:x.y})}},function(t,i,e){e.rotIcon&&(e.rotIcon.hide(),e.rotLine.hide(),e.resizeIcon.hide(),e.topLine.hide(),e.rightLine.hide(),e.bottomLine.hide(),e.leftLine.hide(),e.resizeBottom.hide(),e.resizeLeft.hide(),e.resizeRight.hide(),e.resizeIconRt.hide(),e.resizeIconLt.hide(),e.resizeIconLb.hide(),e._handlesSet=!1)})}}(this)},h=function(t,i,e,n,r,o,a,s){var f,c=this;if(!(c instanceof h))return new h(t,i,e,n,r,o,a,s);var l=[t,i,e,n,r,o,a,s];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){f=t.apply(c,l)}),"function"==typeof f){if(f._classInfo.name!=h._classInfo.name)return new f(t,i,e,n,r,o,a,s)}else if(f)return f;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,l)}):"function"==typeof c.init&&c.init.apply(c,l)
};h._classInfo={name:"surface"},h.prototype=new s,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.surface=h,this.surface=h):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.surface=h:this.surface=h}.call(new Function("return this")());var f=function(){!function(t){t.adjustDivSize=function(){},t.adjustStyleProps=function(){var t=(this.width/this.origWidth).toFixed(5),i=-1*(1/t)*this.width/2,e=-1*(1/t)*this.width/2,n="transform-origin:50% 50%;-webkit-transform-origin:50% 50%; -ms-transform-origin: 50% 50%;",r="translate("+(this.cx+i)+"px,"+(this.cy+e)+"px) scale("+t+")  ;";n+="transform:"+r,n+="-ms-transform:"+r,n+="-webkit-transform:"+r;var o=this.options.bgColor||"blue",a=n+";background-color:"+o+";width:"+this.origWidth+"px;height:"+this.origWidth+"px;position:absolute;left:0px;top:0px;";this.iconG.attr({transform:"scale(1)"}),this.myDiv.attr({style:a})},t.attr=function(t){return this.myDiv.attr(t)},t.draggable=function(t,i,e){return this.myDiv.draggable(t,i,e),this.iconG.draggable(t,i,e),this},t.getElem=function(){return this.myDiv},t.hide=function(){this.myDiv.hide()},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,e,n,r){this.cx=t,this.cy=i,this.origWidth=e,this.width=e,this.iconPath=n,this.options=r||{};var o=_e("div");o.absolute().x(0).y(0);var a=o.svg();a.attr({width:this.width,height:this.width}),this.iconG=a.g(),this.iconG.path({d:n,fill:this.options.iconColor||"white"}),this.myDiv=o,this.adjustStyleProps()}),t.length=function(){var t=this.ex-this.sx,i=this.ey-this.sy;return Math.sqrt(t*t+i*i)},t.moveTo=function(t,i,e){this.cx=t,this.cy=i,e&&(this.width=e),this.adjustStyleProps()},t.show=function(){this.myDiv.show()}}(this)},c=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof c))return new c(t,i,e,n,r,o,a,s);var l=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,l)}),"function"==typeof h){if(h._classInfo.name!=c._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,l)}):"function"==typeof f.init&&f.init.apply(f,l)};c._classInfo={name:"drawIconbox"},c.prototype=new f;var l=function(){!function(t){var i,e,n,r,o,a,s,h;t.add=function(t,i){t.x=t.x+i.x,t.y=t.y+i.y},t.angleBetween=function(t,i){var e=this.normalize({x:t.x,y:t.y}),n=this.normalize({x:i.x,y:i.y}),r=this.crossProd(e,n),o=this.dotProd(e,n),a=Math.acos(o);return 0>r&&(a=-1*a),a},t.calc_cat=function(t,i,e,n,r){var o=t*t,a=o*t;return.5*(2*e+(-i+n)*t+(2*i-5*e+4*n-r)*o+(-i+3*e-3*n+r)*a)},t.crossProd=function(t,i){return t.x*i.y-t.y*i.x},t.diff=function(t,i){return{x:i.x-t.x,y:i.y-t.y}},t.dist=function(t,i){var e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)},t.dotProd=function(t,i){return t.x*i.x+t.y*i.y},t.getBarCoeffs=function(t,i,e){var n=s;return n.A=.5*(-i.y*e.x+t.y*(-i.x+e.x)+t.x*(i.y-e.y)+i.x*e.y),n.sign=n.A<0?-1:1,n.s1=(t.y*e.x-t.x*e.y+(e.y-t.y))*n.sign,n.s2=(e.y-t.y)*n.sign,n.s3=(t.x-e.x)*n.sign,n.t1=(t.x*i.y-t.y*i.x)*n.sign,n.t2=(t.y-i.y)*n.sign,n.t3=(i.x-t.x)*n.sign,n},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){o||(o={x:0,y:0},a={x:0,y:0},i=[0,0,0,0],e={x:0,y:0},n={x:0,y:0},r={x:0,y:0},s={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},h={x:0,y:0})}),t.initProjection=function(t,i){n.y=i.y-t.y,n.x=i.x-t.x,e.y=n.y,e.x=n.x,this.normalize(n),this.normalize(e),this.rotate(e,Math.PI/2),r.x=t.x,r.y=t.y},t.length=function(t){var i=t.x,e=t.y;return Math.sqrt(i*i+e*e)},t.linesIntersect=function(t,i,e,n){var r=t.x,o=t.y,a=i.x,s=i.y,h=e.x,f=e.y,c=n.x,l=n.y,u=((r*s-o*a)*(h-c)-(r-a)*(h*l-f*c))/((r-a)*(f-l)-(o-s)*(h-c)),d=((r*s-o*a)*(f-l)-(o-s)*(h*l-f*c))/((r-a)*(f-l)-(o-s)*(h-c));if(isNaN(u)||isNaN(d))return!1;if(r>=a){if(!(u>=a&&r>=u))return!1}else if(!(u>=r&&a>=u))return!1;if(o>=s){if(!(d>=s&&o>=d))return!1}else if(!(d>=o&&s>=d))return!1;if(h>=c){if(!(u>=c&&h>=u))return!1}else if(!(u>=h&&c>=u))return!1;if(f>=l){if(!(d>=l&&f>=d))return!1}else if(!(d>=f&&l>=d))return!1;return!0},t.mirrorVector=function(t,i,e){o.x=i.x-e.x,o.y=i.y-e.y,a.x=-o.y,a.y=o.x,t.x=t.x-e.x,t.y=t.y-e.y,this.dotProd(t,a)>0&&this.rotate(a,Math.PI),this.normalize(o),this.normalize(a);var n=Math.abs(this.dotProd(t,a)),r=this.dotProd(t,o);return t.x=a.x*n+o.x*r,t.y=a.y*n+o.y*r,t.x+=e.x,t.y+=e.y,t},t.normalize=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y);if(0==i)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/i,t.y=t.y/i,t},t.opposeVector=function(t,i){o.x=i,x,o.y=i.y,a.x=-o.y,a.y=o.x,this.normalize(o),this.normalize(a),this.rotate(o,Math.PI);var e=Math.abs(jsMath.dotProd(t,a)),n=Math.abs(jsMath.dotProd(t,o));return this.dotProd(t,a)<0&&this.rotate(a,Math.PI),t.x=a.x*e+o.x*n,t.y=a.y*e+o.y*n,t},t.pointInTriangle=function(t,i,e,n){var r=.5*(-e.y*n.x+i.y*(-e.x+n.x)+i.x*(e.y-n.y)+e.x*n.y),o=0>r?-1:1,a=(i.y*n.x-i.x*n.y+(n.y-i.y)*t.x+(i.x-n.x)*t.y)*o,s=(i.x*e.y-i.y*e.x+(i.y-e.y)*t.x+(e.x-i.x)*t.y)*o;return a>0&&s>0&&2*r*o>a+s},t.pointInTriangleBc=function(t,i){var e=i.A,n=i.sign,r=i.s1+i.s2*t.x+i.s3*t.y,o=i.t1+i.t2*t.x+i.t3*t.y;return r>0&&o>0&&2*e*n>r+o},t.project=function(t){var i=t;return pVector.x=i.x-r.x,pVector.y=i.y-r.y,prodResult.i=this.dotProd(pVector,n),prodResult.j=this.dotProd(pVector,e),prodResult},t.rotate=function(t,i){var e=Math.sin(i),n=Math.cos(i),r=t.x,o=t.y;return t.x=r*n+o*e,t.y=-r*e+o*n,t},t.rotateAround=function(t,i,e){this.sub(i,e),this.rotate(i,t),this.add(i,e)},t.sub=function(t,i){t.x=t.x-i.x,t.y=t.y-i.y},t.tangentNormal=function(t,i,e){var n={};n.x=i.x-t.x,n.y=i.y-t.y;var r={};r.x=e.x-i.x,r.y=e.y-i.y;var o={x:n.x+r.x,y:n.y+r.y};return this.normalize(o)},t.triangleArea=function(t,i,e){var n=t.x*(i.y-e.y)+i.x*(e.y-t.y)+e.x*(t.y-i.y);return Math.abs(n/2)},t.triangleInTriangle=function(t,i,e,n,r,o){var a=this.getBarCoeffs(t,i,e);if(this.pointInTriangleBc(n,a))return!0;if(this.pointInTriangleBc(r,a))return!0;if(this.pointInTriangleBc(o,a))return!0;var a=this.getBarCoeffs(n,r,o);return this.pointInTriangleBc(t,a)?!0:this.pointInTriangleBc(i,a)?!0:this.pointInTriangleBc(e,a)?!0:this.linesIntersect(t,i,n,r)?!0:this.linesIntersect(i,e,n,r)?!0:this.linesIntersect(e,t,n,r)?!0:this.linesIntersect(t,i,r,o)?!0:this.linesIntersect(i,e,r,o)?!0:this.linesIntersect(e,t,r,o)?!0:this.linesIntersect(t,i,o,n)?!0:this.linesIntersect(i,e,o,n)?!0:this.linesIntersect(e,t,o,n)?!0:!1},t.unProject=function(t){var i=t;return h.x=i.i*n.x+i.j*e.x,h.y=i.i*n.y+i.j*e.y,h.x+=r.x,h.y+=r.y,h}}(this)},u=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof u))return new u(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=u._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};u._classInfo={name:"jsVectors"},u.prototype=new l;var y=function(){!function(t){t.frameClear=function(){},t.getDom=function(){return this._dom},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,e){this._dom=t,this._width=i,this._height=e;var n=_e(t);n.attr({style:"width:"+i+"px;height:"+e+"px;background-color:none;position:absolute;left:0px;top:0px;overflow:hidden;"}),this._renderFns||(this._renderFns={})})}(this)},m=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof m))return new m(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=m._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};y.prototype=h.prototype,m._classInfo={name:"surfaceDom2D"},m.prototype=new y;var p=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.changeCamera=function(t){var i=this.getCamera().getRootNode(),e=this,n=this.getSurface();i.forChildren(function(t){n.removeObject(t,e)}),this._camera=t,i=t.getRootNode(),i.forChildren(function(t){n.startObject(t,e)})},t.getCamera=function(){return this._camera},t.getSurface=function(){return this._surface},t.id=function(){return this._id||(this._id=this.guid()),this._id},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i){console.log("Display constructor called"),console.log(t),console.log(i),this._camera=t,this._surface=i,t.registerDisplay(this)}),t.refreshObject=function(t,i){var e=this.getSurface();e.restartObject(t,this,i);var n=this;t.forChildren(function(i){i!=t&&e.restartObject(i,n,i.renderClass())})},t.render=function(t){t.addToDisplay&&(t.addToDisplay(this.id(),this),this._surface.render(t,this))},t.renderTree=function(t){if(!t||!t.isFulfilled||t.isFulfilled()){if(!t){var i=this.getCamera();t=i.getRootNode()}var e=this.getSurface();if(e.renderTree)return e.renderTree(t,this),this;var n=this;n.render(t),t.items&&t.items.forEach(function(t){n.renderTree(t)})}}}(this)},_=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof _))return new _(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=_._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};_._classInfo={name:"display"},_.prototype=new p,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.display=_,this.display=_):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.display=_:this.display=_}.call(new Function("return this")());var v=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,e){this._dom=t,this._width=i,this._height=e;var n=_e(t);n.attr({style:"width:"+i+"px;height:"+e+"px;background-color:#f3f1e7;position:absolute;left:0px;top:0px;overflow:hidden;"}),this._renderFns||(this._renderFns={})})}(this)},g=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof g))return new g(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=g._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};v.prototype=h.prototype,g._classInfo={name:"surfaceDom3D"},g.prototype=new v;var w=function(){!function(t){t.canvasRender=function(t,i){var e=t.renderClass(),n=this._renderFns;if(n[e]){var r=n[e];t.setRenderScope(this.id());var o=t.getRenderData(this.id());"undefined"==typeof o.state&&(o.state=1),t.askToRemove(this.id())&&(r.end(t,i,o),o.state=3,t.askToRemove(this.id(),!1)),1==o.state&&(r.start(t,i,o),t.projectToCamera(i.getCamera()),r.refresh(t,i,o)),2==o.state&&(t.projectToCamera(i.getCamera()),r.refresh(t,i,o)),t.setRenderScope(null)}},t.frameClear=function(t){if(!this._clearIndex||t!==this._clearIndex){this._clearIndex=t;var i=this.getContext();i.clearRect(0,0,this.getWidth(),this.getHeight())}},t.getContext=function(){return this.getDom().getContext("2d")},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,e){this._width=i,this._height=e;var n=_e(t),r=n.canvas();r.attr({style:"width:"+i+"px;height:"+e+"px;position:absolute;left:0px;top:0px;overflow:hidden;",width:i+"px",height:e+"px"}),r.width(i),r.height(e),n.width(i),n.height(e),this._renderFns||(this._renderFns={}),this._elem=r,this._dom=r._dom}),t.renderTree=function(t,i){if(!t.isFulfilled||t.isFulfilled()){var e=this;e.canvasRender(t,i),t.items&&t.items.forEach(function(t){e.renderTree(t,i)})}}}(this)},I=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof I))return new I(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=I._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};w.prototype=h.prototype,I._classInfo={name:"surfaceDomCanvas"},I.prototype=new w,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.surfaceDomCanvas=I,this.surfaceDomCanvas=I):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.surfaceDomCanvas=I:this.surfaceDomCanvas=I}.call(new Function("return this")());var z=function(){!function(t){t.getHoverLayer=function(){return this._hoverLayer},t.getSvg=function(){return this._childHolder},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,e){this._dom=t,this._width=i,this._height=e;var n=_e(t);this._svgElem=n.svg(),this._svgElem.attr({width:i,height:e}),this._childHolder=this._svgElem.g(),this._hoverLayer=this._svgElem.g(),n.attr({style:"width:"+i+"px;height:"+e+"px;background-color:none;position:absolute;left:0px;top:0px;overflow:hidden;"}),this._renderFns||(this._renderFns={})})}(this)},C=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof C))return new C(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=C._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};z.prototype=h.prototype,C._classInfo={name:"surfaceDomSVG"},C.prototype=new z,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.surfaceDomSVG=C,this.surfaceDomSVG=C):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.surfaceDomSVG=C:this.surfaceDomSVG=C}.call(new Function("return this")());var M=function(){!function(t){t.frameClear=function(){},t.frameFinish=function(t){this._lastFinishT&&this._lastFinishT===t||(this._lastFinishT=t,this._renderer.render(this._stage))},t.getStage=function(){return this._stage},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,e){this._dom=t,this._width=i,this._height=e;var n=_e(t),r=new PIXI.Stage(16777215),o=PIXI.autoDetectRenderer(i,e);this._stage=r,this._renderer=o,n._dom.appendChild(o.view),n.attr({style:"width:"+i+"px;height:"+e+"px;background-color:#f0f0f0;position:absolute;left:0px;top:0px;overflow:hidden;"}),this._renderFns||(this._renderFns={})})}(this)},P=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof P))return new P(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=P._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};M.prototype=h.prototype,P._classInfo={name:"surfaceDomPixi"},P.prototype=new M;var j=function(){!function(t){t.adjustDivSize=function(){},t.adjustStyleProps=function(){var t=(this.width/this.origWidth).toFixed(5),i=-1*(1/t)*this.width/2,e=-1*(1/t)*this.width/2,n="transform-origin:50% 50%;-webkit-transform-origin:50% 50%; -ms-transform-origin: 50% 50%;",r="translate("+(this.cx+i)+"px,"+(this.cy+e)+"px) scale("+t+")  ;";n+="transform:"+r,n+="-ms-transform:"+r,n+="-webkit-transform:"+r;var o=this.options.bgColor||"blue",a=n+";background-color:"+o+";width:"+this.origWidth+"px;height:"+this.origWidth+"px;position:absolute;left:0px;top:0px;";this.myDiv.attr({style:a})},t.attr=function(t){return this.myDiv.attr(t)},t.draggable=function(t,i,e){return this.myDiv.draggable(t,i,e),this},t.getElem=function(){return this.myDiv},t.hide=function(){this.myDiv.hide()},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,e,n){this.cx=t,this.cy=i,this.origWidth=e,this.width=e,this.options=n||{};var r=_e("div");r.absolute().x(0).y(0),this.myDiv=r,this.adjustStyleProps()}),t.length=function(){var t=this.ex-this.sx,i=this.ey-this.sy;return Math.sqrt(t*t+i*i)},t.moveTo=function(t,i,e){this.cx=t,this.cy=i,e&&(this.width=e),this.adjustStyleProps()},t.show=function(){this.myDiv.show()}}(this)},F=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof F))return new F(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=F._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};F._classInfo={name:"drawBox"},F.prototype=new j;var R=function(){!function(t){t.childenToContextBezier=function(t,i){for(var e=0;t.items.item(e+3);){var n=t.items.item(e).getTransformMatrix(),r=t.items.item(e+1).getTransformMatrix(),o=t.items.item(e+2).getTransformMatrix(),a=t.items.item(e+3).getTransformMatrix();0==e&&i.moveTo(n.m30(),n.m31()),i.bezierCurveTo(r.m30(),r.m31(),o.m30(),o.m31(),a.m30(),a.m31()),e+=3}},t.childrenToSvgBezier=function(t){for(var i=0,e="";t.items.item(i+3);){var n=t.items.item(i).getTransformMatrix(),r=t.items.item(i+1).getTransformMatrix(),o=t.items.item(i+2).getTransformMatrix(),a=t.items.item(i+3).getTransformMatrix();0==i&&(e+="M "+n.m30()+" "+n.m31()),e+=" C ",e+=" "+r.m30()+" "+r.m31(),e+=" "+o.m30()+" "+o.m31(),e+=" "+a.m30()+" "+a.m31(),i+=3}return e},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},L=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof L))return new L(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=L._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};L._classInfo={name:"pathTools"},L.prototype=new R;var o=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},a=function(t,i,e,n,r,o,s,h){var f,c=this;if(!(c instanceof a))return new a(t,i,e,n,r,o,s,h);var l=[t,i,e,n,r,o,s,h];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){f=t.apply(c,l)}),"function"==typeof f){if(f._classInfo.name!=a._classInfo.name)return new f(t,i,e,n,r,o,s,h)}else if(f)return f;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,l)}):"function"==typeof c.init&&c.init.apply(c,l)};a._classInfo={name:"drawLine"},a.prototype=new o;var T=function(){!function(t){t.end=function(t,i,e){e.viewG.remove(),e.viewG=null,e.viewObj=null},t.refresh=function(t,i,e){var n=i.getCamera(),r=n.getRenderMatrix().createCopy().inverse();e.viewG.attr({transform:r.getSVGTransform()})},t.start=function(t,i,e){var n=i.getSurface();if(!e.viewObj){var r=n.getSvg(),o=t.displayParent();if(o&&o.getRenderData){var a=o.getRenderData();a.viewG&&(r=a.childG)}e.viewG=r.g(),e.viewObj=e.viewG.g(),e.childG=e.viewG.g(),t.domMVC(e.childG,null,e),t.matchDomPosition(r,e.viewG,t)}}}(this)},S=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof S))return new S(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=S._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};S._classInfo={name:"svgPageRenderer"},S.prototype=new T;var D=function(){!function(t){t.end=function(t,i,e){e.viewG.remove(),e.viewG=null,e.viewObj=null},t.refresh=function(t,i,e){var n=(i.getSurface(),{x:0,y:0,width:t.w(),height:t.h()});t.bgcolor&&(n.fill=t.bgcolor()),t.alpha&&(n["fill-opacity"]=t.alpha()),e.viewObj.attr(n),e.viewG.attr({transform:t.getLocalTransform().getSVGTransform()})},t.start=function(t,i,e){var n=i.getSurface();if(!e.viewObj){var r=n.getSvg(),o=t.displayParent();if(o){var a=o.getRenderData();a.viewG&&(r=a.childG)}e.viewG=r.g(),e.viewObj=e.viewG.rect(),e.childG=e.viewG.g(),t.draggableFor(e.viewObj,i),t.domMVC(e.childG,null,e),t.matchDomPosition(r,e.viewG,t)}}}(this)},E=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof E))return new E(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=E._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};E._classInfo={name:"svgRectRenderer"},E.prototype=new D;var V=function(){!function(t){t.end=function(t,i,e){e.viewG.remove(),e.viewG=null,e.viewObj=null},t.refresh=function(t,i,e){var n=(i.getSurface(),Math.min(t.w()/2,t.h()/2)),r={cx:n,cy:n,r:n};t.bgcolor&&(r.fill=t.bgcolor()),t.alpha&&(r["fill-opacity"]=t.alpha()),e.viewObj.attr(r),e.viewG.attr({transform:t.getLocalTransform().getSVGTransform()})},t.start=function(t,i,e){var n=i.getSurface();if(!e.viewObj){var r=n.getSvg(),o=t.displayParent();if(o){var a=o.getRenderData();a.viewG&&(r=a.childG)}e.viewG=r.g(),e.viewObj=e.viewG.circle(),e.childG=e.viewG.g(),t.draggableFor(e.viewObj,i),t.domMVC(e.childG,null,e),t.matchDomPosition(r,e.viewG,t)}}}(this)},O=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof O))return new O(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=O._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};O._classInfo={name:"svgCircleRenderer"},O.prototype=new V;var B=function(){!function(t){t.end=function(t,i,e){e.viewG.remove(),e.viewG=null,e.viewObj=null},t.refresh=function(t,i,e){var n=(i.getSurface(),Math.min(t.w()/2,t.h()/2),14),r={x:0,y:n};t.fontSize&&(n=r["font-size"]=t.fontSize()),t.bgcolor&&(r.fill=t.bgcolor()),r["font-family"]="Verdana",t.alpha&&(r["fill-opacity"]=t.alpha()),e.viewObj.text(t.text()),e.viewObj.attr(r),e.viewG.attr({transform:t.getLocalTransform().getSVGTransform()})},t.start=function(t,i,e){var n=i.getSurface();if(!e.viewObj){var r=n.getSvg(),o=t.displayParent();if(o){var a=o.getRenderData();a.viewG&&(r=a.childG)}e.viewG=r.g(),e.viewObj=e.viewG.svg_text(),e.childG=e.viewG.g(),t.draggableFor(e.viewObj,i),t.domMVC(e.childG,null,e),t.matchDomPosition(r,e.viewG,t)}}}(this)},G=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof G))return new G(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=G._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};G._classInfo={name:"svgTextRenderer"},G.prototype=new B;var A=function(){!function(t){t.end=function(t,i,e){e.viewG.remove(),e.viewG=null,e.viewObj=null},t.refresh=function(t,i,e){var n=(t.svgPath(),t.w(),t.h(),t.getSvgParser()),r=n.svgString(),o=(i.getSurface(),Math.min(t.w()/2,t.h()/2),{d:r});t.bgcolor&&(o.fill=t.bgcolor()),t.alpha&&(o["fill-opacity"]=t.alpha()),e.viewObj.attr(o),e.viewG.attr({transform:t.getLocalTransform().getSVGTransform()})},t.start=function(t,i,e){var n=i.getSurface();if(!e.viewObj){var r=n.getSvg(),o=t.displayParent();if(o){var a=o.getRenderData();a.viewG&&(r=a.childG)}e.viewG=r.g(),e.viewObj=e.viewG.path(),e.childG=e.viewG.g(),t.draggableFor(e.viewObj,i),t.domMVC(e.childG,null,e),t.matchDomPosition(r,e.viewG,t)}}}(this)},H=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof H))return new H(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=H._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};H._classInfo={name:"svgPathRenderer"},H.prototype=new A;var N=function(){!function(t){t.end=function(t,i,e){e.viewG.remove(),e.viewG=null,e.viewObj=null},t.refresh=function(t,i,e){var n="",r=0,o=0;t.forChildren(function(i){i!=t&&(0==o?n+="M "+i.getX()+" "+i.getY():(0==r&&(n+=" C "),n+=i.getX()+" "+i.getY()+" ",r++,3==r&&(r=0)),o++)});var a=(t.w(),t.h(),n),s=(i.getSurface(),Math.min(t.w()/2,t.h()/2),{d:a});t.bgcolor&&(s.fill=t.bgcolor()),t.alpha&&(s["fill-opacity"]=t.alpha()),e.viewObj.attr(s),e.viewG.attr({transform:t.getLocalTransform().getSVGTransform()})},t.start=function(t,i,e){var n=i.getSurface();if(!e.viewObj){var r=n.getSvg(),o=t.displayParent();if(o){var a=o.getRenderData();a.viewG&&(r=a.childG)}e.viewG=r.g(),e.viewObj=e.viewG.path(),e.childG=e.viewG.g(),t.draggableFor(e.viewObj,i),t.domMVC(e.childG,null,e),t.matchDomPosition(r,e.viewG,t)}}}(this)},k=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof k))return new k(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=k._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};k._classInfo={name:"svgBezierObjectRenderer"},k.prototype=new N;var q=function(){!function(t){t.end=function(t,i,e){e.viewG.remove(),e.viewG=null,e.viewObj=null},t.refresh=function(t,i,e){var n=(i.getSurface(),{x:-1*t.w()/2,y:-1*t.h()/2,width:t.w(),height:t.h()});t.bgcolor&&(n.fill=t.bgcolor()),t.alpha&&(n["fill-opacity"]=t.alpha()),e.viewObj.attr(n),e.viewG.attr({transform:t.getLocalTransform().getSVGTransform()});var r=t.prev();"bezierhandle"==r.renderClass()&&(r=t.next()),e.crossLine.attr({stroke:"cyan",x1:r.getX(),y1:r.getY(),x2:t.getX(),y2:t.getY()})},t.start=function(t,i,e){var n=i.getSurface();if(!e.viewObj){var r=n.getSvg(),o=t.displayParent();if(o){var a=o.getRenderData();a.viewG&&(r=a.childG)}e.viewG=r.g(),e.viewObj=e.viewG.rect(),e.crossLine=e.viewG.parent().parent().line().attr({stroke:"cyan",x1:0,x2:0,y1:0,y2:0}),e.childG=e.viewG.g(),t.draggableFor(e.viewObj,i),t.domMVC(e.childG,null,e),t.matchDomPosition(r,e.viewG,t)}}}(this)},W=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof W))return new W(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=W._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};W._classInfo={name:"svgBezierHandleRenderer"},W.prototype=new q;var Q=function(){!function(t){t.end=function(t,i,e){e.viewG.remove(),e.viewG=null,e.viewObj=null},t.refresh=function(t,i,e){var n=(i.getSurface(),Math.min(t.w()/2,t.h()/2)),r={cx:0,cy:0,r:n};t.bgcolor&&(r.fill=t.bgcolor()),t.alpha&&(r["fill-opacity"]=t.alpha()),e.viewObj.attr(r),e.viewG.attr({transform:t.getLocalTransform().getSVGTransform()})},t.start=function(t,i,e){var n=i.getSurface();if(!e.viewObj){var r=n.getSvg(),o=t.displayParent();if(o){var a=o.getRenderData();a.viewG&&(r=a.childG)}e.viewG=r.g(),e.viewObj=e.viewG.circle(),e.childG=e.viewG.g(),t.draggableFor(e.viewObj,i),t.domMVC(e.childG,null,e),t.matchDomPosition(r,e.viewG,t)}}}(this)},X=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof X))return new X(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=X._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};X._classInfo={name:"svgBezierPointRenderer"},X.prototype=new Q;var U=function(){!function(t){t.end=function(t,i,e){e.viewG.remove(),e.viewG=null,e.viewObj=null},t.refresh=function(t,i,e){if(e._imageObj&&e._width){var n=(i.getSurface(),{});t.alpha&&(n.opacity=t.alpha()),e.viewObj.attr(n),e.viewObj.attr({"xlink:href":t.url(),width:t.w(),height:t.w()*(e._height/e._width)}),e.viewG.attr({transform:t.getLocalTransform().getSVGTransform()})}},t.start=function(t,i,e){if(!e._imageObj){var n=new Image;n.onload=function(){e._imageObj=n,e._width=e._imageObj.width,e._height=e._imageObj.height},n.src=t.url()}var r=i.getSurface();if(!e.viewObj){var o=r.getSvg(),a=t.displayParent();if(a){var s=a.getRenderData();s.viewG&&(o=s.childG)}e.viewG=o.g(),e.viewObj=e.viewG.image({"xlink:href":t.url(),x:0,y:0,height:t.w(),width:t.h()}),e.childG=e.viewG.g(),t.draggableFor(e.viewObj,i),t.domMVC(e.childG,null,e),t.matchDomPosition(o,e.viewG,t)}}}(this)},K=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof K))return new K(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=K._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};K._classInfo={name:"svgImageRenderer"},K.prototype=new U;var Y=function(){!function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.initSvg=function(t){t.registerRenderer("page",new S),t.registerRenderer("none",new S),t.registerRenderer("camera",new S),t.registerRenderer("box",new E),t.registerRenderer("circle",new O),t.registerRenderer("text",new G),t.registerRenderer("svgpath",new H),t.registerRenderer("bezierpath",new k),t.registerRenderer("bezierpoint",new X),t.registerRenderer("bezierhandle",new W),t.registerRenderer("image",new K)}}(this)},J=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof J))return new J(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=J._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};J._classInfo={name:"rendererPackageSVG"},J.prototype=new Y,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.rendererPackageSVG=J,this.rendererPackageSVG=J):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.rendererPackageSVG=J:this.rendererPackageSVG=J}.call(new Function("return this")());var Z=function(){!function(t){t.getHoverLayer=function(){},t.getSvg=function(){return this._svg
},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,e){this._dom=t._dom,this._width=i,this._height=e,this._svg=t,this._renderFns||(this._renderFns={})})}(this)},ti=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof ti))return new ti(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=ti._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};Z.prototype=h.prototype,ti._classInfo={name:"surfaceDomSVGLayer"},ti.prototype=new Z,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.surfaceDomSVGLayer=ti,this.surfaceDomSVGLayer=ti):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.surfaceDomSVGLayer=ti:this.surfaceDomSVGLayer=ti}.call(new Function("return this")());var l=function(){!function(t){var i,e,n,r,o,a,s,h;t.add=function(t,i){t.x=t.x+i.x,t.y=t.y+i.y},t.angleBetween=function(t,i){var e=this.normalize({x:t.x,y:t.y}),n=this.normalize({x:i.x,y:i.y}),r=this.crossProd(e,n),o=this.dotProd(e,n),a=Math.acos(o);return 0>r&&(a=-1*a),a},t.calc_cat=function(t,i,e,n,r){var o=t*t,a=o*t;return.5*(2*e+(-i+n)*t+(2*i-5*e+4*n-r)*o+(-i+3*e-3*n+r)*a)},t.crossProd=function(t,i){return t.x*i.y-t.y*i.x},t.diff=function(t,i){return{x:i.x-t.x,y:i.y-t.y}},t.dist=function(t,i){var e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)},t.dotProd=function(t,i){return t.x*i.x+t.y*i.y},t.getBarCoeffs=function(t,i,e){var n=s;return n.A=.5*(-i.y*e.x+t.y*(-i.x+e.x)+t.x*(i.y-e.y)+i.x*e.y),n.sign=n.A<0?-1:1,n.s1=(t.y*e.x-t.x*e.y+(e.y-t.y))*n.sign,n.s2=(e.y-t.y)*n.sign,n.s3=(t.x-e.x)*n.sign,n.t1=(t.x*i.y-t.y*i.x)*n.sign,n.t2=(t.y-i.y)*n.sign,n.t3=(i.x-t.x)*n.sign,n},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){o||(o={x:0,y:0},a={x:0,y:0},i=[0,0,0,0],e={x:0,y:0},n={x:0,y:0},r={x:0,y:0},s={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},h={x:0,y:0})}),t.initProjection=function(t,i){n.y=i.y-t.y,n.x=i.x-t.x,e.y=n.y,e.x=n.x,this.normalize(n),this.normalize(e),this.rotate(e,Math.PI/2),r.x=t.x,r.y=t.y},t.length=function(t){var i=t.x,e=t.y;return Math.sqrt(i*i+e*e)},t.linesIntersect=function(t,i,e,n){var r=t.x,o=t.y,a=i.x,s=i.y,h=e.x,f=e.y,c=n.x,l=n.y,u=((r*s-o*a)*(h-c)-(r-a)*(h*l-f*c))/((r-a)*(f-l)-(o-s)*(h-c)),d=((r*s-o*a)*(f-l)-(o-s)*(h*l-f*c))/((r-a)*(f-l)-(o-s)*(h-c));if(isNaN(u)||isNaN(d))return!1;if(r>=a){if(!(u>=a&&r>=u))return!1}else if(!(u>=r&&a>=u))return!1;if(o>=s){if(!(d>=s&&o>=d))return!1}else if(!(d>=o&&s>=d))return!1;if(h>=c){if(!(u>=c&&h>=u))return!1}else if(!(u>=h&&c>=u))return!1;if(f>=l){if(!(d>=l&&f>=d))return!1}else if(!(d>=f&&l>=d))return!1;return!0},t.mirrorVector=function(t,i,e){o.x=i.x-e.x,o.y=i.y-e.y,a.x=-o.y,a.y=o.x,t.x=t.x-e.x,t.y=t.y-e.y,this.dotProd(t,a)>0&&this.rotate(a,Math.PI),this.normalize(o),this.normalize(a);var n=Math.abs(this.dotProd(t,a)),r=this.dotProd(t,o);return t.x=a.x*n+o.x*r,t.y=a.y*n+o.y*r,t.x+=e.x,t.y+=e.y,t},t.normalize=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y);if(0==i)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/i,t.y=t.y/i,t},t.opposeVector=function(t,i){o.x=i,x,o.y=i.y,a.x=-o.y,a.y=o.x,this.normalize(o),this.normalize(a),this.rotate(o,Math.PI);var e=Math.abs(jsMath.dotProd(t,a)),n=Math.abs(jsMath.dotProd(t,o));return this.dotProd(t,a)<0&&this.rotate(a,Math.PI),t.x=a.x*e+o.x*n,t.y=a.y*e+o.y*n,t},t.pointInTriangle=function(t,i,e,n){var r=.5*(-e.y*n.x+i.y*(-e.x+n.x)+i.x*(e.y-n.y)+e.x*n.y),o=0>r?-1:1,a=(i.y*n.x-i.x*n.y+(n.y-i.y)*t.x+(i.x-n.x)*t.y)*o,s=(i.x*e.y-i.y*e.x+(i.y-e.y)*t.x+(e.x-i.x)*t.y)*o;return a>0&&s>0&&2*r*o>a+s},t.pointInTriangleBc=function(t,i){var e=i.A,n=i.sign,r=i.s1+i.s2*t.x+i.s3*t.y,o=i.t1+i.t2*t.x+i.t3*t.y;return r>0&&o>0&&2*e*n>r+o},t.project=function(t){var i=t;return pVector.x=i.x-r.x,pVector.y=i.y-r.y,prodResult.i=this.dotProd(pVector,n),prodResult.j=this.dotProd(pVector,e),prodResult},t.rotate=function(t,i){var e=Math.sin(i),n=Math.cos(i),r=t.x,o=t.y;return t.x=r*n+o*e,t.y=-r*e+o*n,t},t.rotateAround=function(t,i,e){this.sub(i,e),this.rotate(i,t),this.add(i,e)},t.sub=function(t,i){t.x=t.x-i.x,t.y=t.y-i.y},t.tangentNormal=function(t,i,e){var n={};n.x=i.x-t.x,n.y=i.y-t.y;var r={};r.x=e.x-i.x,r.y=e.y-i.y;var o={x:n.x+r.x,y:n.y+r.y};return this.normalize(o)},t.triangleArea=function(t,i,e){var n=t.x*(i.y-e.y)+i.x*(e.y-t.y)+e.x*(t.y-i.y);return Math.abs(n/2)},t.triangleInTriangle=function(t,i,e,n,r,o){var a=this.getBarCoeffs(t,i,e);if(this.pointInTriangleBc(n,a))return!0;if(this.pointInTriangleBc(r,a))return!0;if(this.pointInTriangleBc(o,a))return!0;var a=this.getBarCoeffs(n,r,o);return this.pointInTriangleBc(t,a)?!0:this.pointInTriangleBc(i,a)?!0:this.pointInTriangleBc(e,a)?!0:this.linesIntersect(t,i,n,r)?!0:this.linesIntersect(i,e,n,r)?!0:this.linesIntersect(e,t,n,r)?!0:this.linesIntersect(t,i,r,o)?!0:this.linesIntersect(i,e,r,o)?!0:this.linesIntersect(e,t,r,o)?!0:this.linesIntersect(t,i,o,n)?!0:this.linesIntersect(i,e,o,n)?!0:this.linesIntersect(e,t,o,n)?!0:!1},t.unProject=function(t){var i=t;return h.x=i.i*n.x+i.j*e.x,h.y=i.i*n.y+i.j*e.y,h.x+=r.x,h.y+=r.y,h}}(this)},u=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof u))return new u(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=u._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};u._classInfo={name:"jsVectors"},u.prototype=new l;var l=function(){!function(t){var i,e,n,r,o,a,s,h;t.add=function(t,i){t.x=t.x+i.x,t.y=t.y+i.y},t.angleBetween=function(t,i){var e=this.normalize({x:t.x,y:t.y}),n=this.normalize({x:i.x,y:i.y}),r=this.crossProd(e,n),o=this.dotProd(e,n),a=Math.acos(o);return 0>r&&(a=-1*a),a},t.calc_cat=function(t,i,e,n,r){var o=t*t,a=o*t;return.5*(2*e+(-i+n)*t+(2*i-5*e+4*n-r)*o+(-i+3*e-3*n+r)*a)},t.crossProd=function(t,i){return t.x*i.y-t.y*i.x},t.diff=function(t,i){return{x:i.x-t.x,y:i.y-t.y}},t.dist=function(t,i){var e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)},t.dotProd=function(t,i){return t.x*i.x+t.y*i.y},t.getBarCoeffs=function(t,i,e){var n=s;return n.A=.5*(-i.y*e.x+t.y*(-i.x+e.x)+t.x*(i.y-e.y)+i.x*e.y),n.sign=n.A<0?-1:1,n.s1=(t.y*e.x-t.x*e.y+(e.y-t.y))*n.sign,n.s2=(e.y-t.y)*n.sign,n.s3=(t.x-e.x)*n.sign,n.t1=(t.x*i.y-t.y*i.x)*n.sign,n.t2=(t.y-i.y)*n.sign,n.t3=(i.x-t.x)*n.sign,n},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){o||(o={x:0,y:0},a={x:0,y:0},i=[0,0,0,0],e={x:0,y:0},n={x:0,y:0},r={x:0,y:0},s={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},h={x:0,y:0})}),t.initProjection=function(t,i){n.y=i.y-t.y,n.x=i.x-t.x,e.y=n.y,e.x=n.x,this.normalize(n),this.normalize(e),this.rotate(e,Math.PI/2),r.x=t.x,r.y=t.y},t.length=function(t){var i=t.x,e=t.y;return Math.sqrt(i*i+e*e)},t.linesIntersect=function(t,i,e,n){var r=t.x,o=t.y,a=i.x,s=i.y,h=e.x,f=e.y,c=n.x,l=n.y,u=((r*s-o*a)*(h-c)-(r-a)*(h*l-f*c))/((r-a)*(f-l)-(o-s)*(h-c)),d=((r*s-o*a)*(f-l)-(o-s)*(h*l-f*c))/((r-a)*(f-l)-(o-s)*(h-c));if(isNaN(u)||isNaN(d))return!1;if(r>=a){if(!(u>=a&&r>=u))return!1}else if(!(u>=r&&a>=u))return!1;if(o>=s){if(!(d>=s&&o>=d))return!1}else if(!(d>=o&&s>=d))return!1;if(h>=c){if(!(u>=c&&h>=u))return!1}else if(!(u>=h&&c>=u))return!1;if(f>=l){if(!(d>=l&&f>=d))return!1}else if(!(d>=f&&l>=d))return!1;return!0},t.mirrorVector=function(t,i,e){o.x=i.x-e.x,o.y=i.y-e.y,a.x=-o.y,a.y=o.x,t.x=t.x-e.x,t.y=t.y-e.y,this.dotProd(t,a)>0&&this.rotate(a,Math.PI),this.normalize(o),this.normalize(a);var n=Math.abs(this.dotProd(t,a)),r=this.dotProd(t,o);return t.x=a.x*n+o.x*r,t.y=a.y*n+o.y*r,t.x+=e.x,t.y+=e.y,t},t.normalize=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y);if(0==i)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/i,t.y=t.y/i,t},t.opposeVector=function(t,i){o.x=i,x,o.y=i.y,a.x=-o.y,a.y=o.x,this.normalize(o),this.normalize(a),this.rotate(o,Math.PI);var e=Math.abs(jsMath.dotProd(t,a)),n=Math.abs(jsMath.dotProd(t,o));return this.dotProd(t,a)<0&&this.rotate(a,Math.PI),t.x=a.x*e+o.x*n,t.y=a.y*e+o.y*n,t},t.pointInTriangle=function(t,i,e,n){var r=.5*(-e.y*n.x+i.y*(-e.x+n.x)+i.x*(e.y-n.y)+e.x*n.y),o=0>r?-1:1,a=(i.y*n.x-i.x*n.y+(n.y-i.y)*t.x+(i.x-n.x)*t.y)*o,s=(i.x*e.y-i.y*e.x+(i.y-e.y)*t.x+(e.x-i.x)*t.y)*o;return a>0&&s>0&&2*r*o>a+s},t.pointInTriangleBc=function(t,i){var e=i.A,n=i.sign,r=i.s1+i.s2*t.x+i.s3*t.y,o=i.t1+i.t2*t.x+i.t3*t.y;return r>0&&o>0&&2*e*n>r+o},t.project=function(t){var i=t;return pVector.x=i.x-r.x,pVector.y=i.y-r.y,prodResult.i=this.dotProd(pVector,n),prodResult.j=this.dotProd(pVector,e),prodResult},t.rotate=function(t,i){var e=Math.sin(i),n=Math.cos(i),r=t.x,o=t.y;return t.x=r*n+o*e,t.y=-r*e+o*n,t},t.rotateAround=function(t,i,e){this.sub(i,e),this.rotate(i,t),this.add(i,e)},t.sub=function(t,i){t.x=t.x-i.x,t.y=t.y-i.y},t.tangentNormal=function(t,i,e){var n={};n.x=i.x-t.x,n.y=i.y-t.y;var r={};r.x=e.x-i.x,r.y=e.y-i.y;var o={x:n.x+r.x,y:n.y+r.y};return this.normalize(o)},t.triangleArea=function(t,i,e){var n=t.x*(i.y-e.y)+i.x*(e.y-t.y)+e.x*(t.y-i.y);return Math.abs(n/2)},t.triangleInTriangle=function(t,i,e,n,r,o){var a=this.getBarCoeffs(t,i,e);if(this.pointInTriangleBc(n,a))return!0;if(this.pointInTriangleBc(r,a))return!0;if(this.pointInTriangleBc(o,a))return!0;var a=this.getBarCoeffs(n,r,o);return this.pointInTriangleBc(t,a)?!0:this.pointInTriangleBc(i,a)?!0:this.pointInTriangleBc(e,a)?!0:this.linesIntersect(t,i,n,r)?!0:this.linesIntersect(i,e,n,r)?!0:this.linesIntersect(e,t,n,r)?!0:this.linesIntersect(t,i,r,o)?!0:this.linesIntersect(i,e,r,o)?!0:this.linesIntersect(e,t,r,o)?!0:this.linesIntersect(t,i,o,n)?!0:this.linesIntersect(i,e,o,n)?!0:this.linesIntersect(e,t,o,n)?!0:!1},t.unProject=function(t){var i=t;return h.x=i.i*n.x+i.j*e.x,h.y=i.i*n.y+i.j*e.y,h.x+=r.x,h.y+=r.y,h}}(this)},u=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof u))return new u(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=u._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};u._classInfo={name:"jsVectors"},u.prototype=new l;var ii=function(){!function(t){t.copy=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,e,n){this.x=t||0,this.y=i||0,this.z=e||0,this.w=void 0!==n?n:1}),t.inverse=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.multiply=function(t,i){i||(i=t,t=this);var e=t.x*i.w+t.y*i.z-t.z*i.y+t.w*i.x,n=-t.x*i.z+t.y*i.w+t.z*i.x+t.w*i.y,r=t.x*i.y-t.y*i.x+t.z*i.w+t.w*i.z,o=-t.x*i.x-t.y*i.y-t.z*i.z+t.w*i.w;return this.x=e,this.y=n,this.z=r,this.w=o,this},t.normalizeVector3D=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0==i||isNaN(i)?{x:1,y:0,z:0}:{x:t.x/i,y:t.y/i,z:t.z/i}},t.projectVector=function(t){var i={x:0,y:0,z:0},e=t.x,n=t.y,r=t.z,o=this.x,a=this.y,s=this.z,h=this.w,f=h*e+a*r-s*n,c=h*n+s*e-o*r,l=h*r+o*n-a*e,u=-o*e-a*n-s*r;return i.x=f*h+u*-o+c*-s-l*-a,i.y=c*h+u*-a+l*-o-f*-s,i.z=l*h+u*-s+f*-a-c*-o,i},t.rotate=function(t){return this.setFromAxisRotation({x:0,y:0,z:1},t),this},t.setFromAxisRotation=function(t,i){t=this.normalizeVector3D(t);var e=i/2,n=Math.sin(e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(e),this}}(this)},ei=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof ei))return new ei(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=ei._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};ei._classInfo={name:"quaternion"},ei.prototype=new ii;var ni=function(){!function(t){var i;t.derivate=function(t,i){var e=this._points[t][0],n=this._points[t][1],r=this._points[t][2],o=this._points[t][3],a=i*i,s=1-i,h=s*s,f=3*h*(n-e)+6*i*s*(r-n)+3*a*(o-r);return f},t.distanceOf=function(t,i){var e=this.findClosestT(t,i),n=this.x(e)-t,r=this.y(e)-i;return Math.sqrt(n*n+r*r)},t.findClosestT=function(t,i){for(var e=0,n=.5,r=1,o=10;o--;){var a=this.x(e)-t,s=this.y(e)-i,h=this.x(r)-t,f=this.y(r)-i,c=Math.sqrt(a*a+s*s),l=Math.sqrt(h*h+f*f);l>c?r=n:e=n,n=e+(r-e)/2}var a=this.x(e)-t,s=this.y(e)-i,u=this.x(n)-t,d=this.y(n)-i;h=this.x(r)-t,f=this.y(r)-i;var c=Math.sqrt(a*a+s*s),y=Math.sqrt(u*u+d*d),l=Math.sqrt(h*h+f*f);return y>c&&l>c?e:y>l&&c>l?r:n},t.fitListTo=function(t){{var e={x:t[0].point_x(0),y:t[0].point_y(0)},n=t.length-1,r={x:t[n].point_x(3),y:t[n].point_y(3)},o={x:this.x(0),y:this.y(0)},a={x:this.x(1),y:this.y(1)},s=a.x-o.x,h=a.y-o.y,f=(Math.sqrt(s*s+h*h),r.x-e.x),c=r.y-e.y;Math.sqrt(f*f+c*c),i.angleBetween({x:s,y:h},{x:f,y:c})}},t.fromLine=function(t,i){var e=i.x-t.x,n=e/3;this.initCoeffs(0,t.x,t.x+n,t.x+2*n,i.x);var e=i.y-t.y,n=e/3;this.initCoeffs(1,t.y,t.y+n,t.y+2*n,i.y)},t.fromPoints=function(t,i,e,n){this.initCoeffs(0,t.x,i.x,e.x,n.x),this.initCoeffs(1,t.y,i.y,e.y,n.y)},t.fromQuadCurve=function(t,i,e){this.initCoeffs(0,t.x,t.x+2/3*(i.x-t.x),e.x+2/3*(i.x-e.x),e.x),this.initCoeffs(0,t.y,t.y+2/3*(i.y-t.y),e.y+2/3*(i.y-e.y),e.y)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._points=[],this._m=[],i||(i=u())}),t.initCoeffs=function(t,i,e,n,r){this._coeffs||(this._coeffs=[]),this._coeffs[t]||(this._coeffs[t]=[]),this._points[t]||(this._points[t]=[]),this._points[t][0]=i,this._points[t][1]=e,this._points[t][2]=n,this._points[t][3]=r;var o=this._coeffs[t];o[0]=3*(e-i),o[1]=3*(n-e)-o[0],o[2]=r-i-o[0]-o[1],o[3]=i},t.inverseProject=function(t){var i=t.t,e=this.normal(i,!0),n=e.x*t.nvProd+this.x(i),r=e.y*t.nvProd+this.y(i),o=this.tangent(i,!0);n+=t.tangetProd*o.x,r+=t.tangetProd*o.y,t.ix=n,t.iy=r},t.mirrorControls=function(){var t={x:this._points[0][0],y:this._points[1][0]},e={x:this._points[0][3],y:this._points[1][3]},n={x:this._points[0][1],y:this._points[1][1]},r={x:this._points[0][2],y:this._points[1][2]};i.mirrorVector(n,e,t),i.mirrorVector(r,e,t),this.initCoeffs(0,t.x,n.x,r.x,e.x),this.initCoeffs(1,t.y,n.y,r.y,e.y)},t.normal=function(t,e){var n=this.tangent(t),r=n.x;return n.x=-n.y,n.y=r,e&&i.normalize(n),n},t.point_x=function(t){return this._points[0][t]},t.point_y=function(t){return this._points[1][t]},t.points=function(){return this._m},t.projectPoint=function(t,i,e){for(var n=20,r=.5,o=.25;n--;){var a=this.tangent(r,!0);dv.x=t-this.x(r),dv.y=i-this.y(r);var s=dv.x*a.x+dv.y*a.y;if(Math.abs(s)<.05)break;r+=s>0?o:-o,o/=2}var h=this.normal(r,!0);return e||(e={}),e.tangentProd=s,e.nvProd=h.x*dv.x+h.y*d.y,e.nv_x=h.x,e.nv_y=h.y,e.tn_x=a.x,e.tn_y=a.y,e.ix=0,e.iy=0,e.t=r,e},t.setControls=function(t,i,e,n){this.initCoeffs(0,t.x,i.x,e.x,n.x),this.initCoeffs(1,t.y,i.y,e.y,n.y)},t.split=function(t){var i=this._points[0],e=this.splitCoeff(i[0],i[1],i[2],i[3],t);i=this._points[1];var n=this.splitCoeff(i[0],i[1],i[2],i[3],t);this.fromPoints({x:e.p0,y:n.p0},{x:e.p1,y:n.p1},{x:e.p2,y:n.p2},{x:e.p3,y:n.p3});var r=ri();return r.fromPoints({x:e.p3,y:n.p3},{x:e.p4,y:n.p4},{x:e.p5,y:n.p5},{x:e.p6,y:n.p6}),r},t.splitCoeff=function(t,i,e,n,r){var o={};o.p0=t,o.p1=(1-r)*t+r*i;var a=(1-r)*i+r*e;return o.p5=(1-r)*e+r*n,o.p2=(1-r)*o.p1+r*a,o.p4=(1-r)*a+r*o.p5,o.p3=(1-r)*o.p2+r*o.p4,o.p6=n,o},t.step=function(t,i){if(this._coeffs){var e=this._coeffs[i];if(e){var n=t*t,r=n*t;return e[2]*r+e[1]*n+e[0]*t+e[3]}}},t.tangent=function(t,e){var n={};return n.x=this.derivate(0,t),n.y=this.derivate(1,t),e&&i.normalize(n),n},t.x=function(t){return this.step(t,0)},t.y=function(t){return this.step(t,1)},t.z=function(t){return this.step(t,2)}}(this)},ri=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof ri))return new ri(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=ri._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};ri._classInfo={name:"jsBezierCurve"},ri.prototype=new ni;var l=function(){!function(t){var i,e,n,r,o,a,s,h;t.add=function(t,i){t.x=t.x+i.x,t.y=t.y+i.y},t.angleBetween=function(t,i){var e=this.normalize({x:t.x,y:t.y}),n=this.normalize({x:i.x,y:i.y}),r=this.crossProd(e,n),o=this.dotProd(e,n),a=Math.acos(o);return 0>r&&(a=-1*a),a},t.calc_cat=function(t,i,e,n,r){var o=t*t,a=o*t;return.5*(2*e+(-i+n)*t+(2*i-5*e+4*n-r)*o+(-i+3*e-3*n+r)*a)},t.crossProd=function(t,i){return t.x*i.y-t.y*i.x},t.diff=function(t,i){return{x:i.x-t.x,y:i.y-t.y}},t.dist=function(t,i){var e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)},t.dotProd=function(t,i){return t.x*i.x+t.y*i.y},t.getBarCoeffs=function(t,i,e){var n=s;return n.A=.5*(-i.y*e.x+t.y*(-i.x+e.x)+t.x*(i.y-e.y)+i.x*e.y),n.sign=n.A<0?-1:1,n.s1=(t.y*e.x-t.x*e.y+(e.y-t.y))*n.sign,n.s2=(e.y-t.y)*n.sign,n.s3=(t.x-e.x)*n.sign,n.t1=(t.x*i.y-t.y*i.x)*n.sign,n.t2=(t.y-i.y)*n.sign,n.t3=(i.x-t.x)*n.sign,n},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){o||(o={x:0,y:0},a={x:0,y:0},i=[0,0,0,0],e={x:0,y:0},n={x:0,y:0},r={x:0,y:0},s={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},h={x:0,y:0})}),t.initProjection=function(t,i){n.y=i.y-t.y,n.x=i.x-t.x,e.y=n.y,e.x=n.x,this.normalize(n),this.normalize(e),this.rotate(e,Math.PI/2),r.x=t.x,r.y=t.y},t.length=function(t){var i=t.x,e=t.y;return Math.sqrt(i*i+e*e)},t.linesIntersect=function(t,i,e,n){var r=t.x,o=t.y,a=i.x,s=i.y,h=e.x,f=e.y,c=n.x,l=n.y,u=((r*s-o*a)*(h-c)-(r-a)*(h*l-f*c))/((r-a)*(f-l)-(o-s)*(h-c)),d=((r*s-o*a)*(f-l)-(o-s)*(h*l-f*c))/((r-a)*(f-l)-(o-s)*(h-c));if(isNaN(u)||isNaN(d))return!1;if(r>=a){if(!(u>=a&&r>=u))return!1}else if(!(u>=r&&a>=u))return!1;if(o>=s){if(!(d>=s&&o>=d))return!1}else if(!(d>=o&&s>=d))return!1;if(h>=c){if(!(u>=c&&h>=u))return!1}else if(!(u>=h&&c>=u))return!1;if(f>=l){if(!(d>=l&&f>=d))return!1}else if(!(d>=f&&l>=d))return!1;return!0},t.mirrorVector=function(t,i,e){o.x=i.x-e.x,o.y=i.y-e.y,a.x=-o.y,a.y=o.x,t.x=t.x-e.x,t.y=t.y-e.y,this.dotProd(t,a)>0&&this.rotate(a,Math.PI),this.normalize(o),this.normalize(a);var n=Math.abs(this.dotProd(t,a)),r=this.dotProd(t,o);return t.x=a.x*n+o.x*r,t.y=a.y*n+o.y*r,t.x+=e.x,t.y+=e.y,t},t.normalize=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y);if(0==i)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/i,t.y=t.y/i,t},t.opposeVector=function(t,i){o.x=i,x,o.y=i.y,a.x=-o.y,a.y=o.x,this.normalize(o),this.normalize(a),this.rotate(o,Math.PI);var e=Math.abs(jsMath.dotProd(t,a)),n=Math.abs(jsMath.dotProd(t,o));return this.dotProd(t,a)<0&&this.rotate(a,Math.PI),t.x=a.x*e+o.x*n,t.y=a.y*e+o.y*n,t},t.pointInTriangle=function(t,i,e,n){var r=.5*(-e.y*n.x+i.y*(-e.x+n.x)+i.x*(e.y-n.y)+e.x*n.y),o=0>r?-1:1,a=(i.y*n.x-i.x*n.y+(n.y-i.y)*t.x+(i.x-n.x)*t.y)*o,s=(i.x*e.y-i.y*e.x+(i.y-e.y)*t.x+(e.x-i.x)*t.y)*o;return a>0&&s>0&&2*r*o>a+s},t.pointInTriangleBc=function(t,i){var e=i.A,n=i.sign,r=i.s1+i.s2*t.x+i.s3*t.y,o=i.t1+i.t2*t.x+i.t3*t.y;return r>0&&o>0&&2*e*n>r+o},t.project=function(t){var i=t;return pVector.x=i.x-r.x,pVector.y=i.y-r.y,prodResult.i=this.dotProd(pVector,n),prodResult.j=this.dotProd(pVector,e),prodResult},t.rotate=function(t,i){var e=Math.sin(i),n=Math.cos(i),r=t.x,o=t.y;return t.x=r*n+o*e,t.y=-r*e+o*n,t},t.rotateAround=function(t,i,e){this.sub(i,e),this.rotate(i,t),this.add(i,e)},t.sub=function(t,i){t.x=t.x-i.x,t.y=t.y-i.y},t.tangentNormal=function(t,i,e){var n={};n.x=i.x-t.x,n.y=i.y-t.y;var r={};r.x=e.x-i.x,r.y=e.y-i.y;var o={x:n.x+r.x,y:n.y+r.y};return this.normalize(o)},t.triangleArea=function(t,i,e){var n=t.x*(i.y-e.y)+i.x*(e.y-t.y)+e.x*(t.y-i.y);return Math.abs(n/2)},t.triangleInTriangle=function(t,i,e,n,r,o){var a=this.getBarCoeffs(t,i,e);if(this.pointInTriangleBc(n,a))return!0;if(this.pointInTriangleBc(r,a))return!0;if(this.pointInTriangleBc(o,a))return!0;var a=this.getBarCoeffs(n,r,o);return this.pointInTriangleBc(t,a)?!0:this.pointInTriangleBc(i,a)?!0:this.pointInTriangleBc(e,a)?!0:this.linesIntersect(t,i,n,r)?!0:this.linesIntersect(i,e,n,r)?!0:this.linesIntersect(e,t,n,r)?!0:this.linesIntersect(t,i,r,o)?!0:this.linesIntersect(i,e,r,o)?!0:this.linesIntersect(e,t,r,o)?!0:this.linesIntersect(t,i,o,n)?!0:this.linesIntersect(i,e,o,n)?!0:this.linesIntersect(e,t,o,n)?!0:!1},t.unProject=function(t){var i=t;return h.x=i.i*n.x+i.j*e.x,h.y=i.i*n.y+i.j*e.y,h.x+=r.x,h.y+=r.y,h}}(this)},u=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof u))return new u(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=u._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};u._classInfo={name:"jsVectors"},u.prototype=new l;var oi=function(){!function(t){t.bezierSplit=function(t,i,e,n,r){var o={};o.p1=(1-r)*t+r*i;var a=(1-r)*i+r*e;return o.p5=(1-r)*e+r*n,o.p2=(1-r)*o.p1+r*a,o.p4=(1-r)*a+r*o.p5,o.p3=(1-r)*o.p2+r*o.p4,o},t.endPoint=function(t,i,e){t||(t={x:0,y:0,z:0}),i||(i=ei());var n=0;return e||(e=function(t){return t}),this.list.forEach(function(r){if(n++,"Q"==r.cmd){var o=0;r.path.forEach(function(n){n=e(n);var r={x:n.d,y:0,z:0};i.multiply(n.q);var a=i.projectVector(r);t.x+=a.x,t.y+=a.y,t.z+=a.z,o++})}if("M"==r.cmd&&r.path.forEach(function(n){n=e(n);var r={x:n.d,y:0,z:0};i.multiply(n.q);var o=i.projectVector(r);t.x+=o.x,t.y+=o.y,t.z+=o.z}),"L"==r.cmd&&r.path.forEach(function(n){n=e(n);var r={x:n.d,y:0,z:0};i.multiply(n.q);var o=i.projectVector(r);t.x+=o.x,t.y+=o.y,t.z+=o.z}),"C"==r.cmd){var o=0;r.path.forEach(function(n){n=e(n);var r={x:n.d,y:0,z:0};i.multiply(n.q);var a=i.projectVector(r);t.x+=a.x,t.y+=a.y,t.z+=a.z,o++})}}),t},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this.list=t}),t.partToSvgPath=function(t,i,e,n){var r="";e||(e={x:0,y:0,z:0}),n||(n=ei()),this.addedObjects=[];var o=this,a=0;return this.list.forEach(function(s){if(a++,!(t>a||a>i)){var h=_e("g");if(h.circle().attr({fill:"#ffaa88",cx:e.x,cy:e.y,r:10}),h.svg_text().attr({x:e.x,y:e.y+10,"font-size":20,fill:"black"}).text(a+""),o.addedObjects.push(h),"Q"==s.cmd){var f=0;s.path.forEach(function(t){var i={x:t.d,y:0,z:0};n.multiply(t.q);var o=n.projectVector(i);e.x+=o.x,e.y+=o.y,e.z+=o.z,0==f&&(r+="Q "),r+=" "+e.x.toFixed(3)+", "+e.y.toFixed(3),f++})}if("M"==s.cmd&&s.path.forEach(function(t){var i={x:t.d,y:0,z:0};n.multiply(t.q);var o=n.projectVector(i);e.x+=o.x,e.y+=o.y,e.z+=o.z,r+="M "+e.x.toFixed(3)+", "+e.y.toFixed(3)}),"L"==s.cmd&&s.path.forEach(function(t){var i={x:t.d,y:0,z:0};n.multiply(t.q);var o=n.projectVector(i);e.x+=o.x,e.y+=o.y,e.z+=o.z,r+="L "+e.x.toFixed(3)+", "+e.y.toFixed(3)}),"C"==s.cmd){var f=0;s.path.forEach(function(t){var i={x:t.d,y:0,z:0};n.multiply(t.q);var o=n.projectVector(i);e.x+=o.x,e.y+=o.y,e.z+=o.z,0==f&&(r+="C "),r+=" "+e.x.toFixed(3)+", "+e.y.toFixed(3),f++})}}}),r},t.pathFunction=function(){},t.quadToCubic=function(t,i,e){return{p0:t,p1:t+2/3*(i-t),p2:e+2/3*(i-e),p3:e}},t.toSvgCubicPath=function(t,i){var e="";t||(t={x:0,y:0,z:0}),i||(i=ei());var n=0;return this.list.forEach(function(r){var o={x:r.d,y:0,z:0};i.multiply(r.q);var a=i.projectVector(o);t.x+=a.x,t.y+=a.y,t.z+=a.z,e+=0==n?"C "+t.x.toFixed(3)+", "+t.y.toFixed(3):" "+t.x.toFixed(3)+", "+t.y.toFixed(3),n++}),e},t.toSvgPath=function(t,i,e){var n="";t||(t={x:0,y:0,z:0}),i||(i=ei()),this.addedObjects=[];var r=0;return e||(e=function(t){return t}),this.list.forEach(function(o){if(r++,"Q"==o.cmd){var a=0;o.path.forEach(function(r){r=e(r);var o={x:r.d,y:0,z:0};i.multiply(r.q);var s=i.projectVector(o);t.x+=s.x,t.y+=s.y,t.z+=s.z,0==a&&(n+="Q "),n+=" "+t.x.toFixed(3)+", "+t.y.toFixed(3),a++})}if("M"==o.cmd&&o.path.forEach(function(r){r=e(r);var o={x:r.d,y:0,z:0};i.multiply(r.q);var a=i.projectVector(o);t.x+=a.x,t.y+=a.y,t.z+=a.z,n+="M "+t.x.toFixed(3)+", "+t.y.toFixed(3)}),"L"==o.cmd&&o.path.forEach(function(r){r=e(r);var o={x:r.d,y:0,z:0};i.multiply(r.q);var a=i.projectVector(o);t.x+=a.x,t.y+=a.y,t.z+=a.z,n+="L "+t.x.toFixed(3)+", "+t.y.toFixed(3)}),"C"==o.cmd){var a=0;o.path.forEach(function(r){r=e(r);var o={x:r.d,y:0,z:0};i.multiply(r.q);var s=i.projectVector(o);t.x+=s.x,t.y+=s.y,t.z+=s.z,0==a&&(n+="C "),n+=" "+t.x.toFixed(3)+", "+t.y.toFixed(3),a++})}}),n}}(this)},ai=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof ai))return new ai(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=ai._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};ai._classInfo={name:"pathIterator"},ai.prototype=new oi;var si=function(){!function(t){var i;t.drawPath=function(t){var i,e;t.beginPath(),this._all.forEach(function(n){if("M"==n.name&&(i=n.points[0],e=n.points[1],t.moveTo(i,e)),"m"==n.name&&(i+=n.points[0],e+=n.points[1],t.moveTo(i,e)),"q"==n.name)for(var r=0;r<n.points.length;r+=4){var o=n.points,a=i+o[r+0],s=e+o[r+1],h=i+o[r+2],f=e+o[r+3];i=h,e=f,t.quadraticCurveTo(a,s,h,f,l,u)}if("Q"==n.name)for(var o=n.points,c=n.points.length,r=0;c>r;r+=4)t.quadraticCurveTo(o[r+0],o[r+1],o[r+2],o[r+3]);if("c"==n.name)for(var r=0;r<n.points.length;r+=6){var o=n.points,a=i+o[r+0],s=e+o[r+1],h=i+o[r+2],f=e+o[r+3],l=i+o[r+4],u=e+o[r+5];i=l,e=u,t.bezierCurveTo(a,s,h,f,l,u)}if("C"==n.name)for(var o=n.points,c=n.points.length,r=0;c>r;r+=6)t.bezierCurveTo(o[r+0],o[r+1],o[r+2],o[r+3],o[r+4],o[r+5]);if("l"==n.name)for(var r=0;r<n.points.length;r+=2){var o=n.points,a=i+o[r+0],s=e+o[r+1];i=a,e=s,t.lineTo(a,s)}if("H"==n.name)for(var r=0;r<n.points.length;r++){var o=n.points,a=o[r+0];i=a,t.lineTo(a,e)}if("V"==n.name)for(var r=0;r<n.points.length;r++){var o=n.points,s=o[r+0];e=s,t.lineTo(i,s)}if("L"==n.name)for(var r=0;r<n.points.length;r+=2){var o=n.points,a=o[r+0],s=o[r+1];i=a,e=s,t.lineTo(a,s)}"z"==n.name&&t.closePath()})},t.findDimensions=function(){if(this._limits)return this._limits;var t,i,e,n,r,o,a=function(r,o){"undefined"==typeof t&&(t=r,e=r,i=o,n=o),t=Math.min(t,r),i=Math.min(i,o),e=Math.max(e,r),n=Math.max(n,o)};return this._all.forEach(function(t){if("M"==t.name&&(r=t.points[0],o=t.points[1],a(r,o)),"m"==t.name&&(r+=t.points[0],o+=t.points[1],a(r,o)),"c"==t.name)for(var i=0;i<t.points.length;i+=6){var e=t.points,n=r+e[i+0],s=o+e[i+1],h=r+e[i+2],f=o+e[i+3],c=r+e[i+4],l=o+e[i+5];a(n,s),a(h,f),a(c,l),r=c,o=l}if("C"==t.name)for(var e=t.points,u=t.points.length,i=0;u>i;i+=6)a(e[i+0],e[i+1]),a(e[i+2],e[i+3]),a(e[i+4],e[i+5]);if("l"==t.name)for(var i=0;i<t.points.length;i+=2){var e=t.points,n=r+e[i+0],s=o+e[i+1];r=n,o=s,a(r,o)}if("L"==t.name)for(var i=0;i<t.points.length;i+=2){var e=t.points,n=e[i+0],s=e[i+1];r=n,o=s,a(r,o)}}),this._limits=[t,i,e,n],this._limits},t.fitPathInto=function(t,i){for(var e=this.findDimensions(),n=!0,r=0;4>r;r++)(e[r]<0||e[r]>t)&&(n=!1);var o=Math.abs(e[2]-e[0]),a=Math.abs(e[3]-e[1]),s=!1;Math.abs(e[3])<Math.abs(e[1])&&(s=!0);var h=t/o,f=i/a,c=-e[0],l=-e[1],u=Math.min(h,f),d=u;s&&(d=-d,l=-e[3]);var y=function(t){return(t+c)*u},m=function(t){return(t+l)*d};this._all.forEach(function(t){if("M"==t.name&&(t.points[0]=y(t.points[0]),t.points[1]=m(t.points[1])),"m"==t.name&&(t.points[0]*=u,t.points[1]*=d),"L"==t.name)for(var i=0;i<t.points.length;i+=2){var e=t.points;e[i+0]=y(e[i+0]),e[i+1]=m(e[i+1])}if("c"==t.name)for(var i=0;i<t.points.length;i+=6){var e=t.points;e[i+0]*=u,e[i+2]*=u,e[i+4]*=u,e[i+1]*=d,e[i+3]*=d,e[i+5]*=d}if("C"==t.name)for(var e=t.points,n=t.points.length,i=0;n>i;i+=6)e[i+0]=y(e[i+0]),e[i+2]=y(e[i+2]),e[i+4]=y(e[i+4]),e[i+1]=m(e[i+1]),e[i+3]=m(e[i+3]),e[i+5]=m(e[i+5]);if("Q"==t.name)for(var e=t.points,n=t.points.length,i=0;n>i;i+=4)e[i+0]=y(e[i+0]),e[i+2]=y(e[i+2]),e[i+1]=m(e[i+1]),e[i+3]=m(e[i+3]);if("l"==t.name)for(var i=0;i<t.points.length;i+=2){var e=t.points;e[i+0]*=u,e[i+1]*=d}}),this._limits=null},t.forCmds=function(t){this._all.forEach(t)},t.fromBezierArray=function(t){{var i,e=t.length;this._all}this._all=[];for(var i=0;e>i;i++){var n=t[i];if(0==i){var r={name:"M",points:[n.point_x(0),n.point_y(0)]};this._all.push(r)}var r={name:"C",points:[n.point_x(1),n.point_y(1),n.point_x(2),n.point_y(2),n.point_x(3),n.point_y(3)]};this._all.push(r)}this.saveToOriginals()},t.getCommands=function(){return this._all},t.getPath=function(t){return this._all[t]},t.getSegmentCount=function(){var t=this._all.length;return"z"==this._all[t-1].name&&t--,t},t.getSubPaths=function(){return this._subPaths},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._activeCmd=null,this._all=[],this._stringLeft="",this._original=null,this._x=0,this._y=0,i||(i={})}),t.initCmd=function(t){return this._activeCmd={name:t,points:[]},this._all.push(this._activeCmd),this._activeCmd},t.inverse=function(){var t,i=this.originals(),e=i.length;this._all.reverse();var i=(this._all,this._all),n=[],r=function(t,i){for(var e=[],n=t.points.length/2,r=t.points.length-4;n>0;){if(1==n){if(!i)return e;r=i.points.length-2,e.push(i.points[r]),e.push(i.points[r+1])}else e.push(t.points[r]),e.push(t.points[r+1]),r-=2;n--}return e};"z"==i[0].name&&i.shift();for(var t=0;e>t;t++){{var o,a=i[t];i[t],i[t+1]}if(!a)break;if(t>0&&(o=i[t-1]),0==t){var s=a.points.length-2,h={name:"M",points:[a.points[s],a.points[s+1]]};n.push(h)}else{var h={name:o.name,points:r(o,a)};n.push(h)}}var h={name:"z",points:[]};n.push(h),this._all=n},t.makePathAbsolute=function(){var t,i,e,n,r=!0,o=function(){r&&(e=t,n=i);var o=t-e,a=i-n;return{x:t+o,y:i+a}};this._all.forEach(function(a){if("M"==a.name&&(t=a.points[0],i=a.points[1],r=!0),"L"==a.name&&(t=a.points[0],i=a.points[1],r=!0),"m"==a.name&&(t+=a.points[0],i+=a.points[1],a.points[0]=t,a.points[1]=i,a.name="M",r=!0),"q"==a.name){for(var s=0;s<a.points.length;s+=4){var h=a.points;h[s+0]=t+h[s+0],h[s+1]=i+h[s+1],h[s+2]=t+h[s+2],h[s+3]=i+h[s+3],t=h[s+2],i=h[s+3],a.name="Q"}r=!0}if("C"==a.name){var h=a.points;e=h[2],n=h[3],t=h[4],i=h[5],r=!1}if("c"==a.name){for(var s=0;s<a.points.length;s+=6){var h=a.points;h[s+0]=t+h[s+0],h[s+1]=i+h[s+1],h[s+2]=t+h[s+2],h[s+3]=i+h[s+3],h[s+4]=t+h[s+4],h[s+5]=i+h[s+5],t=h[s+4],i=h[s+5],e=h[s+2],n=h[s+3],a.name="C"}r=!1}if("S"==a.name){var h=a.points,f=o(),c=[];c[0]=f.x,c[1]=f.y,c[2]=h[0],c[3]=h[1],c[4]=h[2],c[5]=h[3],t=c[4],i=c[5],e=c[2],n=c[3],a.name="C",a.points=c,r=!1}if("s"==a.name){var h=a.points,f=o(),c=[];c[0]=f.x,c[1]=f.y,c[2]=t+h[0],c[3]=i+h[1],c[4]=t+h[2],c[5]=i+h[3],t=c[4],i=c[5],e=c[2],n=c[3],a.name="C",a.points=c,r=!1}if("h"==a.name){r=!0;for(var s=0;s<a.points.length;s++){var h=a.points,l=t+h[s+0];return t=l,h[s+0]=l,a.points=[l,i],void(a.name="L")}}if("H"==a.name){r=!0;for(var s=0;s<a.points.length;s++){var h=a.points,l=h[s+0];return t=l,h[s+0]=l,a.points=[l,i],void(a.name="L")}}if("V"==a.name){r=!0;for(var s=0;s<a.points.length;s++){var h=a.points,u=h[s+0];return i=u,a.points=[t,u],void(a.name="L")}}if("v"==a.name){r=!0;for(var s=0;s<a.points.length;s++){var h=a.points,u=i+h[s+0];return i=u,a.points=[t,u],void(a.name="L")
}}if("l"==a.name){r=!0;for(var s=0;s<a.points.length;s+=2){var h=a.points,l=t+h[s+0],u=i+h[s+1];t=l,i=u,h[s+0]=l,h[s+1]=u,a.name="L"}}})},t.normalize=function(t,i){t||(t=800),i||(i=800),this.makePathAbsolute(),this.fitPathInto(t,i)},t.originals=function(){return this._original||(this._original=JSON.parse(JSON.stringify(this._all))),this._original},t.parse=function(t){this._activeCmd=null,this._all=[],this._stringLeft="",this._original=null,this._x=0,this._y=0,this._usedCommands={},t||(t="M25.979,12.896 L 5.979,12.896,5.979,19.562,25.979,19.562z");var i=t,e=0,n=1e4;for(this._subPaths=t.split("M"),this._subIndex=0;(i=this.popCommand(i))&&0!=i.length&&i.length!=e&&!(n--<0);)e=i.length;return this._all},t.path=function(){return this._all},t.pathFunction=function(){},t.popCommand=function(t){t=t.trim();var i=t.charAt(0),e=null;if("M"==i&&(e=this.initCmd(i),t=t.substring(1)),"m"==i&&(e=this.initCmd(i),t=t.substring(1)),"Q"==i&&(e=this.initCmd(i),t=t.substring(1)),"q"==i&&(e=this.initCmd(i),t=t.substring(1)),"S"==i&&(e=this.initCmd(i),t=t.substring(1)),"s"==i&&(e=this.initCmd(i),t=t.substring(1)),"C"==i&&(e=this.initCmd(i),t=t.substring(1)),"c"==i&&(e=this.initCmd(i),t=t.substring(1)),"H"==i&&(e=this.initCmd(i),t=t.substring(1)),"h"==i&&(e=this.initCmd(i),t=t.substring(1)),"V"==i&&(e=this.initCmd(i),t=t.substring(1)),"v"==i&&(e=this.initCmd(i),t=t.substring(1)),"L"==i&&(e=this.initCmd(i),t=t.substring(1)),"l"==i&&(e=this.initCmd(i),t=t.substring(1)),"Z"==i&&(e=this.initCmd(i),t=t.substring(1)),"z"==i&&(e=this.initCmd(i),t=t.substring(1)),e){this._usedCommands[i]="true",t=t.trim();for(var n=!0;n&&t.length>0;){var r=t.charAt(0);","==r&&(t=t.substring(1),t=t.trim());for(var o=["-","1","2","3","4","5","6","7","8","9","0","."],a="",s=0;o.indexOf(t.charAt(0))>=0&&!("-"==t.charAt(0)&&(s++,s>1));)a+=t.charAt(0),t=t.substring(1),s=1;if(!(a.length>0))break;e.points.push(parseFloat(a)),t=t.trim()}}return e||(console.error("No command found for"),console.error(t)),this._activeCmd=e,this._stringLeft=t,t},t.relativePosition=function(t){var i=this.toBezierArray(),e=i.length,n=e*t,r=Math.floor(n);r>=e&&(r=e-1),0>r&&(r=0);var o=i[r],a=1/e,s=r/e,h=t,f=h-s,c=f/a,l={x:0,y:0,normal:{x:0,y:0}};l.x=o.x(c),l.y=o.y(c);var u=o.tangent(c,!0);return l.normal.x=u.x,l.normal.y=u.y,l},t.replacePartWith=function(t,i,e){var n=function(t,i){var e=hi();e.parse(t),e.makePathAbsolute();var n=e.toBezierArray();e.fromBezierArray(n),i&&e.inverse();var r=e.toQuaternionPath(),o=function(t,i){var e=ai(r),n=e.endPoint(),o="M 0 0 "+e.toSvgPath(),a=t;if(0==i.x&&0==i.y)return"";var s=Math.sqrt(n.x*n.x+n.y*n.y),h=Math.sqrt(i.x*i.x+i.y*i.y),f=h/s;if(0==s)return o;var c=u(),l=c.angleBetween(n,i),o=e.toSvgPath(a,ei().rotate(l),function(t){return t.d=t.d*f,t});return o};return o},r=this.getPath(t);r.replaceFunction=n(i,e)},t.saveToOriginals=function(){this._original=JSON.parse(JSON.stringify(this._all))},t.scaleFactor=function(t,i){var e=this.findDimensions(),n=Math.abs(e[2]-e[0]),r=Math.abs(e[3]-e[1]),o=t/n,a=i/r,s=Math.min(o,a);return s},t.svgString=function(){var t,i,e="";return this._all.forEach(function(n){if("M"==n.name&&(t=n.points[0],i=n.points[1],e+="M"+t+","+i+" "),"m"==n.name&&(t+=n.points[0],i+=n.points[1],e+="M"+t+","+i+" "),"q"==n.name){e+="Q";for(var r=0;r<n.points.length;r+=4){var o=n.points,a=t+o[r+0],s=i+o[r+1],h=t+o[r+2],f=i+o[r+3];t=h,i=f,e+=a+","+s+" "+h+","+f+" "}}if("Q"==n.name){var o=n.points,c=n.points.length;e+="Q";for(var r=0;c>r;r+=4){var a=o[r+0],s=o[r+1],h=o[r+2],f=o[r+3];t=h,i=f,e+=a+","+s+" "+h+","+f+" "}}if("c"==n.name){e+="C";for(var r=0;r<n.points.length;r+=6){var o=n.points,a=t+o[r+0],s=i+o[r+1],h=t+o[r+2],f=i+o[r+3],l=t+o[r+4],u=i+o[r+5];t=l,i=u,e+=a+","+s+" "+h+","+f+" "+l+","+u+" "}}if("C"==n.name){var o=n.points,c=n.points.length;if(n.replaceFunction){for(var d={x:t,y:i},r=0;c>r;r+=6)t=o[r+4],i=o[r+5];var y={x:t-d.x,y:i-d.y},m=n.replaceFunction(d,y);console.log("The inserted path ",m),e+=" "+m+" "}else{e+="C";for(var r=0;c>r;r+=6)e+=o[r+0]+","+o[r+1]+" "+o[r+2]+","+o[r+3]+" "+o[r+4]+","+o[r+5]+" ",t=o[r+4],i=o[r+5]}}if("l"==n.name){e+="L";for(var r=0;r<n.points.length;r+=2){var o=n.points,a=t+o[r+0],s=i+o[r+1];t=a,i=s,e+=a+","+s+" "}}if("H"==n.name){e+="L";for(var r=0;r<n.points.length;r++){var o=n.points,a=o[r+0];t=a,e+=a+","+i+" "}}if("V"==n.name){e+="L";for(var r=0;r<n.points.length;r++){var o=n.points,s=o[r+0];i=s,e+=t+","+s+" "}}if("L"==n.name)if(n.replaceFunction){for(var d={x:t,y:i},r=0;r<n.points.length;r+=2){var o=n.points,a=o[r+0],s=o[r+1];t=a,i=s}var y={x:t-d.x,y:i-d.y},m=n.replaceFunction(d,y);console.log("The inserted path ",m),e+=" "+m+" "}else{e+="L";for(var r=0;r<n.points.length;r+=2){var o=n.points,a=o[r+0],s=o[r+1];t=a,i=s,e+=a+","+s+" "}}"z"==n.name&&(e+="z")}),e},t.toBezierArray=function(){var t,i,e="",n=[];return this._all.forEach(function(r){if("M"==r.name&&(t=r.points[0],i=r.points[1]),"Q"==r.name)for(var o=r.points,a=r.points.length,s=0;a>s;s+=4){var h=o[s+0],f=o[s+1],c=o[s+2],l=o[s+3],u=new ri;u.fromQuadCurve({x:t,y:i},{x:h,y:f},{x:c,y:l}),n.push(u),t=c,i=l}if("C"==r.name)for(var o=r.points,a=r.points.length,s=0;a>s;s+=6){var h=o[s+0],f=o[s+1],c=o[s+2],l=o[s+3],d=o[s+4],y=o[s+5],u=new ri;u.fromPoints({x:t,y:i},{x:h,y:f},{x:c,y:l},{x:d,y:y}),n.push(u),t=d,i=y}if("L"==r.name){e+="L";for(var s=0;s<r.points.length;s+=2){var o=r.points,h=o[s+0],f=o[s+1],u=new ri;u.fromLine({x:t,y:i},{x:h,y:f}),n.push(u),t=h,i=f}}}),n},t.toQuaternionPath=function(){var t=!0,i={x:0,y:0},e={x:100,y:0},n={x:100,y:0},r=u(),o=[];return this.forCmds(function(a){var s={cmd:a.name,path:[]},h=function(o,a){e.x=o-i.x,e.y=a-i.y;var h=Math.sqrt(e.x*e.x+e.y*e.y);0==h&&(e.x+=.2,e.y+=.2,o+=.02,a+=.02,h=Math.sqrt(e.x*e.x+e.y*e.y));var f=r.angleBetween(n,e),c=ei();c.setFromAxisRotation({x:0,y:0,z:1},f),t||s.path.push({q:c,d:h}),t=!1,i.x=o,i.y=a,n.x=e.x,n.y=e.y};"M"==a.name&&h(a.points[0],a.points[1]),"L"==a.name&&h(a.points[0],a.points[1]),"Q"==a.name&&(h(a.points[0],a.points[1]),h(a.points[2],a.points[3])),"C"==a.name&&(h(a.points[0],a.points[1]),h(a.points[2],a.points[3]),h(a.points[4],a.points[5])),s.path.length&&o.push(s)}),o},t.transformPoints=function(t){for(var i,e=this.originals(),n={x:0,y:0},r=e.length,i=(this._all,0);r>i;i++){var o=e[i],a=this._all[i];if(!o)return;if("M"==o.name&&(n.x=o.points[0],n.y=o.points[1],t(n),a.points[0]=n.x,a.points[1]=n.y),"Q"==o.name)for(var s=o.points,h=a.points,f=o.points.length,c=0;f>c;c+=4)n.x=s[c+0],n.y=s[c+1],t(n),h[c+0]=n.x,h[c+1]=n.y,n.x=s[c+2],n.y=s[c+3],t(n),h[c+2]=n.x,h[c+3]=n.y;if("C"==o.name)for(var s=o.points,h=a.points,f=o.points.length,c=0;f>c;c+=6)n.x=s[c+0],n.y=s[c+1],t(n),h[c+0]=n.x,h[c+1]=n.y,n.x=s[c+2],n.y=s[c+3],t(n),h[c+2]=n.x,h[c+3]=n.y,n.x=s[c+4],n.y=s[c+5],t(n),h[c+4]=n.x,h[c+5]=n.y;if("L"==o.name)for(var c=0;c<o.points.length;c+=2){var s=o.points,h=a.points;n.x=s[c+0],n.y=s[c+1],t(n),h[c+0]=n.x,h[c+1]=n.y}}}}(this)},hi=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof hi))return new hi(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=hi._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};hi._classInfo={name:"svgPathParser"},hi.prototype=new si,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.svgPathParser=hi,this.svgPathParser=hi):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.svgPathParser=hi:this.svgPathParser=hi}.call(new Function("return this")());var ni=function(){!function(t){var i;t.derivate=function(t,i){var e=this._points[t][0],n=this._points[t][1],r=this._points[t][2],o=this._points[t][3],a=i*i,s=1-i,h=s*s,f=3*h*(n-e)+6*i*s*(r-n)+3*a*(o-r);return f},t.distanceOf=function(t,i){var e=this.findClosestT(t,i),n=this.x(e)-t,r=this.y(e)-i;return Math.sqrt(n*n+r*r)},t.findClosestT=function(t,i){for(var e=0,n=.5,r=1,o=10;o--;){var a=this.x(e)-t,s=this.y(e)-i,h=this.x(r)-t,f=this.y(r)-i,c=Math.sqrt(a*a+s*s),l=Math.sqrt(h*h+f*f);l>c?r=n:e=n,n=e+(r-e)/2}var a=this.x(e)-t,s=this.y(e)-i,u=this.x(n)-t,d=this.y(n)-i;h=this.x(r)-t,f=this.y(r)-i;var c=Math.sqrt(a*a+s*s),y=Math.sqrt(u*u+d*d),l=Math.sqrt(h*h+f*f);return y>c&&l>c?e:y>l&&c>l?r:n},t.fitListTo=function(t){{var e={x:t[0].point_x(0),y:t[0].point_y(0)},n=t.length-1,r={x:t[n].point_x(3),y:t[n].point_y(3)},o={x:this.x(0),y:this.y(0)},a={x:this.x(1),y:this.y(1)},s=a.x-o.x,h=a.y-o.y,f=(Math.sqrt(s*s+h*h),r.x-e.x),c=r.y-e.y;Math.sqrt(f*f+c*c),i.angleBetween({x:s,y:h},{x:f,y:c})}},t.fromLine=function(t,i){var e=i.x-t.x,n=e/3;this.initCoeffs(0,t.x,t.x+n,t.x+2*n,i.x);var e=i.y-t.y,n=e/3;this.initCoeffs(1,t.y,t.y+n,t.y+2*n,i.y)},t.fromPoints=function(t,i,e,n){this.initCoeffs(0,t.x,i.x,e.x,n.x),this.initCoeffs(1,t.y,i.y,e.y,n.y)},t.fromQuadCurve=function(t,i,e){this.initCoeffs(0,t.x,t.x+2/3*(i.x-t.x),e.x+2/3*(i.x-e.x),e.x),this.initCoeffs(0,t.y,t.y+2/3*(i.y-t.y),e.y+2/3*(i.y-e.y),e.y)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._points=[],this._m=[],i||(i=u())}),t.initCoeffs=function(t,i,e,n,r){this._coeffs||(this._coeffs=[]),this._coeffs[t]||(this._coeffs[t]=[]),this._points[t]||(this._points[t]=[]),this._points[t][0]=i,this._points[t][1]=e,this._points[t][2]=n,this._points[t][3]=r;var o=this._coeffs[t];o[0]=3*(e-i),o[1]=3*(n-e)-o[0],o[2]=r-i-o[0]-o[1],o[3]=i},t.inverseProject=function(t){var i=t.t,e=this.normal(i,!0),n=e.x*t.nvProd+this.x(i),r=e.y*t.nvProd+this.y(i),o=this.tangent(i,!0);n+=t.tangetProd*o.x,r+=t.tangetProd*o.y,t.ix=n,t.iy=r},t.mirrorControls=function(){var t={x:this._points[0][0],y:this._points[1][0]},e={x:this._points[0][3],y:this._points[1][3]},n={x:this._points[0][1],y:this._points[1][1]},r={x:this._points[0][2],y:this._points[1][2]};i.mirrorVector(n,e,t),i.mirrorVector(r,e,t),this.initCoeffs(0,t.x,n.x,r.x,e.x),this.initCoeffs(1,t.y,n.y,r.y,e.y)},t.normal=function(t,e){var n=this.tangent(t),r=n.x;return n.x=-n.y,n.y=r,e&&i.normalize(n),n},t.point_x=function(t){return this._points[0][t]},t.point_y=function(t){return this._points[1][t]},t.points=function(){return this._m},t.projectPoint=function(t,i,e){for(var n=20,r=.5,o=.25;n--;){var a=this.tangent(r,!0);dv.x=t-this.x(r),dv.y=i-this.y(r);var s=dv.x*a.x+dv.y*a.y;if(Math.abs(s)<.05)break;r+=s>0?o:-o,o/=2}var h=this.normal(r,!0);return e||(e={}),e.tangentProd=s,e.nvProd=h.x*dv.x+h.y*d.y,e.nv_x=h.x,e.nv_y=h.y,e.tn_x=a.x,e.tn_y=a.y,e.ix=0,e.iy=0,e.t=r,e},t.setControls=function(t,i,e,n){this.initCoeffs(0,t.x,i.x,e.x,n.x),this.initCoeffs(1,t.y,i.y,e.y,n.y)},t.split=function(t){var i=this._points[0],e=this.splitCoeff(i[0],i[1],i[2],i[3],t);i=this._points[1];var n=this.splitCoeff(i[0],i[1],i[2],i[3],t);this.fromPoints({x:e.p0,y:n.p0},{x:e.p1,y:n.p1},{x:e.p2,y:n.p2},{x:e.p3,y:n.p3});var r=ri();return r.fromPoints({x:e.p3,y:n.p3},{x:e.p4,y:n.p4},{x:e.p5,y:n.p5},{x:e.p6,y:n.p6}),r},t.splitCoeff=function(t,i,e,n,r){var o={};o.p0=t,o.p1=(1-r)*t+r*i;var a=(1-r)*i+r*e;return o.p5=(1-r)*e+r*n,o.p2=(1-r)*o.p1+r*a,o.p4=(1-r)*a+r*o.p5,o.p3=(1-r)*o.p2+r*o.p4,o.p6=n,o},t.step=function(t,i){if(this._coeffs){var e=this._coeffs[i];if(e){var n=t*t,r=n*t;return e[2]*r+e[1]*n+e[0]*t+e[3]}}},t.tangent=function(t,e){var n={};return n.x=this.derivate(0,t),n.y=this.derivate(1,t),e&&i.normalize(n),n},t.x=function(t){return this.step(t,0)},t.y=function(t){return this.step(t,1)},t.z=function(t){return this.step(t,2)}}(this)},ri=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof ri))return new ri(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=ri._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};ri._classInfo={name:"jsBezierCurve"},ri.prototype=new ni;var fi=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.indexOf=function(t){return"undefined"==typeof t?this._model.indexOf():this._model&&this._model.items?this._model.items.indexOf(t._callRender?t.model():t):-1},t.isArray=function(t){return"undefined"==typeof t?this.__isA:"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return"undefined"==typeof t?this.__isO:t===Object(t)}}(this),function(t){t.displayParent=function(){if(this._extParent)return this._extParent;var t=this._model.parent();if(t){var i=t.parent();if(i)return ci(i)}},t.firstChild=function(){return this.items?this.items.item(0):void 0},t.forChildren=function(t){if(t(this),this.items){this.items.forEach(function(i){i.forChildren(t)})}},t.next=function(t){if(t)return this;var i=this._model.indexOf(),e=this._model.parent();return e?e.item(i+1):void 0},t.prev=function(t){if(t)return console.error("Setting prev and next not implemented"),this;var i=this._model.indexOf(),e=this._model.parent();return e&&i>0?e.item(i-1):void 0}}(this),function(t){t.createBox=function(){},t.createEmptyBook=function(){return _data({data:{type:"displayItem",renderClass:"book",w:1e3,h:1e3,ri:0,rj:0,items:{data:[{data:{type:"displayItem",renderClass:"page",w:1e3,h:1e3,ri:0,rj:0,items:{data:[],__id:this.guid()},rmatrix:{data:{m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1},__id:this.guid()}},__id:this.guid()}],__id:this.guid()},rmatrix:{data:{m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1},__id:this.guid()}},__id:this.guid()})},t.createObject=function(t,i){i=i||{};var e={type:"displayItem",renderClass:t,bgcolor:"red",x:0,y:0,w:300,h:300,ri:0,rj:0,alpha:1,scaleFactor:1,rmatrix:{m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1},items:[]};if(i)for(var n in i)"noParent"!=n&&(e[n]=i[n]);if(i.noParent){var r=_data(e);return r}var o=this.items.length();this.items.push(e);var a=ci(this.items.at(o));return a}}(this),function(t){t.align=function(t){return"undefined"!=typeof t?(this._model.set("align",t),this):this._model.get("align")},t.alpha=function(t){return"undefined"!=typeof t?(this._model.set("alpha",t),this):this._model.get("alpha")},t.autoFit=function(t){return"undefined"!=typeof t?(this._model.set("autoFit",t),this):this._model.get("autoFit")},t.bgcolor=function(t){return"undefined"!=typeof t?(this._model.set("bgcolor",t),this):this._ext?this._extModel.get("bgcolor"):this._model.get("bgcolor")},t.fitToPage=function(t){return"undefined"!=typeof t?(this._model.set("fitToPage",t),this):this._model.get("fitToPage")},t.fontFamily=function(t){return"undefined"!=typeof t?(this._model.set("fontFamily",t),this):this._model.get("fontFamily")},t.fontSize=function(t){return"undefined"!=typeof t?(this._model.set("fontSize",t),this):this._model.get("fontSize")},t.get=function(t){return this._model.get(t)},t.h=function(t){return"undefined"!=typeof t?(this._model.set("h",t),this):this._model.get("h")},t.hasOwn=function(t){return this._model.hasOwn(t)},t.model=function(){return this._model},t.parent=function(){if(this._extParent)return this._extParent._model.items;var t=this._model.parent();return t?this._find(t.getID()):void 0},t.rad=function(t){return"undefined"!=typeof t?(this._model.set("rad",t),this):this._model.get("rad")},t.renderClass=function(t){return"undefined"!=typeof t?(this._model.set("renderClass",t),this):this._model.get("renderClass")},t.ri=function(t){return"undefined"!=typeof t?(this._model.set("ri",t),this):this._model.get("ri")||0},t.rj=function(t){return"undefined"!=typeof t?(this._model.set("rj",t),this):this._model.get("rj")||0},t.scaleFactor=function(t){return"undefined"!=typeof t?(this._model.set("scaleFactor",t),this):this._model.get("scaleFactor")},t.set=function(t,i){return"undefined"!=typeof i?(this._model.set(t,i),this):this._model.get(t)},t.shadowBlur=function(t){return"undefined"!=typeof t?(this._model.set("shadowBlur",t),this):this._model.get("shadowBlur")},t.shadowColor=function(t){return"undefined"!=typeof t?(this._model.set("shadowColor",t),this):this._model.get("shadowColor")},t.svgPath=function(t){return"undefined"!=typeof t?(this._model.set("svgPath",t),this):this._model.get("svgPath")},t.text=function(t){return"undefined"!=typeof t?(this._model.set("text",t),this):this._model.get("text")},t.txtAlign=function(t){return"undefined"!=typeof t?(this._model.set("txtAlign",t),this):this._model.get("txtAlign")},t.w=function(t){return"undefined"!=typeof t?(this._model.set("w",t),this):this._model.get("w")},t.x=function(t){return"undefined"!=typeof t?(this._model.set("x",t),this):this._model.get("x")},t.y=function(t){return"undefined"!=typeof t?(this._model.set("y",t),this):this._model.get("y")}}(this),function(t){t.on=function(t,i){return this._ev||(this._ev={}),this._ev[t]||(this._ev[t]=[]),this._ev[t].push(i),this._model&&this._model.on(t,i),this},t.trigger=function(t,i,e){if(this._ev&&this._ev[t]){var n=this;return this._ev[t].forEach(function(t){t(n,i,e)}),this}}}(this),function(t){var i,n,o,a,s,h,f,c,l,d,y,m,p,_,x,v;t._callCamera=function(){var t=this.renderClass();c[t]&&c[t](this)},t._callRender=function(){var t=this.renderClass();if(i){i[t]?i[t](this):this._renderFn;var e=this.getRenderData();e.lastIndex=h.renderIndex,this.items&&this.items.forEach(function(t){t._callRender()}),this._handlesVisible&&this.showHandles()}},t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t){if(_&&t&&t.getID){var i=t.getID(),e=_[i];if(e)return e}}),t._find=function(t){_||(_={});var i=_[t];return i?i:ci(_data(t))},t._getTransfromFromModel=function(t){var i=t;t.on("x",function(t,e){var n=i.getTransformMatrix();n.m30(e)}),t.on("y",function(t,e){var n=i.getTransformMatrix();n.m31(e)}),t.on("scaleFactor",function(t,e){var n=i.getScaleMatrix();n.scale(e)}),t.on("rad",function(t,e){if(!isNaN(e)){var n=Math.sin(e),r=Math.cos(e),o=i.getRotationMatrix();o.m00(r),o.m11(r),o.m10(-1*n),o.m01(n)}});var e=!1;if(t.x&&t.y&&(t.translate(t.x(),t.y(),0),e=!0),t.rad){var n=t.rad();if(!isNaN(n)){var r=Math.sin(n),o=Math.cos(n),a=i.getRotationMatrix();a.m00(o),a.m11(o),a.m10(-1*r),a.m01(r)}}t.scaleFactor&&(t.scale(t.scaleFactor()),e=!0)},t._onFrame=function(){var t=(new Date).getTime();if(x){var i=t-x;if(i>v)return v=2*i,void(x=t)}x=t;var e=h.renderIndex;d.forEach(function(t){t.getSurface().frameClear(e)}),d.forEach(function(t){var i=t.getCamera();i._callCamera();var e=i.getRootNode();e.startRootTransform()}),d.forEach(function(t){t.renderTree()}),d.forEach(function(t){var i=t.getSurface();i.frameFinish&&i.frameFinish(e)}),d.forEach(function(t){var i=t.getCamera(),e=i.getRootNode();e.saveTransformUpdates()}),h.renderIndex++},t._prepareCameras=function(){f&&f.forEach(function(t){t._callCamera&&t._callCamera()})},t.activeItemsBB=function(t){var i={};return this.forActiveItems(function(e){e.projectToCamera(t);var n=e.getViewMatrix(t),r=[];r.push(n.projectVector({x:0,y:0,z:0,w:1})),r.push(n.projectVector({x:e.w(),y:0,z:0,w:1})),r.push(n.projectVector({x:e.w(),y:e.h(),z:0,w:1})),r.push(n.projectVector({x:0,y:e.h(),z:0,w:1})),r.forEach(function(t){"undefined"==typeof i.xmin&&(i.xmin=t.x,i.xmax=t.x),"undefined"==typeof i.ymin&&(i.ymin=t.y,i.ymax=t.y),t.x<i.xmin&&(i.xmin=t.x),t.y<i.ymin&&(i.ymin=t.y),t.x>i.xmax&&(i.xmax=t.x),t.y>i.ymax&&(i.ymax=t.y)})}),i},t.addActiveItem=function(t,i){if(i&&this.clearActiveItems(),this.isArray(t)){var e=this;return t.forEach(function(t){e.addActiveItem(t)}),this}o.indexOf(t)>=0||(o.push(t),p.forEach(function(i){i(t)}))},t.addCamera=function(t){f.indexOf(t)<0&&f.push(t)},t.addToDisplay=function(t,i){this._displayList||(this._displayList={}),this.isObject(t)&&(i=t,t=i.id()),this._displayList[t]=i},t.addToGroup=function(t){if(t!=this){var i=this.parent();if(i&&(i=i.parent()),i&&i!=t){var e=this.getRenderMatrix().projectVector({x:this.w()*this.ri(),y:this.h()*this.rj(),z:0,w:1}),n=t.getRenderMatrix().createCopy().inverse(),r=n.projectVector(e),o=t._rotMatrix.createCopy().inverse().matMul(this._rotMatrix),a=t._scaleMatrix.createCopy().inverse().matMul(this._scaleMatrix);this._transMatrix.m30(r.x),this._transMatrix.m31(r.y),this._transMatrix.m32(r.z),this._rotMatrix.copyFrom(o),this._scaleMatrix.copyFrom(a),this.remove(),t.items.push(this),this.callRender()}}},t.addToRenderList=function(t){if((!t.isFulfilled||t.isFulfilled())&&h){for(var i,e=t;(i=e.parent())&&i.addToRenderList;)e=i;h.list.indexOf(e)<0&&h.list.push(e)}},t.applyLocalTransform=function(t){var i=r(),e=0,n=0;t?(e=t.i,n=t.j):this.ri&&(e=this.ri(),n=this.rj());var o=r();return o.translate({x:-1*e*this.w(),y:-1*n*this.h(),z:0}),i.matMul(this._transMatrix),i.matMul(this._scaleMatrix),i.matMul(this._rotMatrix),i.matMul(o),i},t.applyTransforms=function(t,i){var e=r();t=t?t.createCopy():r(),this._lastParentMatrix?this._lastParentMatrix.copyFrom(t):this._lastParentMatrix=t.createCopy(),this._scaleMatrix.blend();var n=0,o=0;this.ri&&(n=this.ri(),o=this.rj());var a=r();a.translate({x:n*this.w(),y:o*this.h(),z:0});var s=r();s.translate({x:-1*n*this.w(),y:-1*o*this.h(),z:0});this._rotMatrix.createCopy();e.matMul(this._transMatrix);var h=t.createCopy();if(h.matMul(this._transMatrix),this._beforeRot=h,e.matMul(this._scaleMatrix),e.matMul(this._rotMatrix),e.matMul(s),this._localTransform=e,t.matMul(e),this._renderMatrix&&this._renderMatrix.copyFrom(t),this.items&&!i){var f=this._renderMatrix;this.items.forEach(function(t){t.applyTransforms&&t.applyTransforms(f)})}return this._renderMatrix},t.areHandlesVisible=function(){return this._handlesVisible},t.askToRemove=function(t,i){return this._askToRemove||(this._askToRemove={}),"undefined"==typeof i?this._askToRemove[t]:void(this._askToRemove[t]=i)},t.callRender=function(){this.render()},t.changeRenderClass=function(t){var i=this.renderClass();this.renderClass(t);var e=this;this.forDisplays(function(t){t.refreshObject(e,i)})},t.clearActiveItems=function(){o.length=0},t.delegateEvent=function(t,i,e){return"undefined"!=typeof e?(this._eventDelegates||(this._eventDelegates={}),this._eventDelegates[t]||(this._eventDelegates[t]={}),this._eventDelegates[t][i]=e,this):this.findDelegatedEventhandler(t,i)},t.domMVC=function(t,i,e){return i||(i=t,t=this),t?t._model?void t._model.then(function(){t._model.items&&(t._model.on("remove",function(){e&&e.viewObj&&(e.viewG.remove(),delete e.viewObj)}),t._model.items.on("move",function(t,e){var n=i.child(e.from),r=i.child(e.to);e.to!=e.from&&(e.to<e.from?r.insertBefore(n):r.insertAfter(n))}),t._model.items.on("remove",function(t,i){return}),i.reIndex())}):void console.error("No obj model at domMVC ",e):void console.error("No obj at domMVC ",e)},t.draggableFor=function(t,i){var e=this;this.listenDragEventsFor(t,function(){y.shiftDown||e.clearActiveItems(),e.addActiveItem(e)},function(t){e._movementLock&&(e._movementLock.x&&(t.delta.x=0),e._movementLock.y&&(t.delta.y=0)),e._transMatrix.translate({x:t.start.x+t.delta.x,y:t.start.y+t.delta.y,z:t.start.z+t.delta.z}),e.callRender()},function(){},i,"move")},t.findAndRegisterCameras=function(){var t=this;this.forChildren(function(i){i.isCamera&&i.isCamera()&&t.addCamera(i)})},t.findCameras=function(){var t=[];return this.forChildren(function(i){i.isCamera&&i.isCamera()&&t.push(i)}),t},t.findDelegatedEventhandler=function(t,i){for(var e,n=this;e=n.isDelegatingEvents(t,i);)n=e;if(n._dragListeners&&n._dragListeners[t]){var r=n._dragListeners[t][i];return r}},t.forActiveItems=function(t){o.forEach(function(i){t(i)})},t.forDisplays=function(t){if(this._displayList){var i=this._displayList;for(var e in i)if(i.hasOwnProperty(e)){var n=i[e];t(n)}}},t.getActiveCamera=function(){return l||(l=f[0]),l},t.getCamera=function(t){return f[t]},t.getDOMOffset=function(t){for(;t&&t instanceof SVGElement;)t=t.parentNode;if(!t)return{x:0,y:0};var i,e=t&&t.ownerDocument,n=e.documentElement;try{i=t.getBoundingClientRect()}catch(r){}var o=e.body,a=window,s=n.clientTop||o.clientTop||0,h=n.clientLeft||o.clientLeft||0,f=a.pageYOffset||jQuery.support.boxModel&&n.scrollTop||o.scrollTop,c=a.pageXOffset||jQuery.support.boxModel&&n.scrollLeft||o.scrollLeft,l=i.top+f-s,u=i.left+c-h;return{x:u,y:l}},t.getLocalTransform=function(){return this._localTransform},t.getRenderData=function(t){if(this._renderData||(this._renderData={}),!t&&m&&(t=m),t){var i="sub__"+t;return this._renderData[i]||(this._renderData[i]={}),this._renderData[i]}return this._renderData},t.getRenderFn=function(){return this._renderFn},t.getRenderMatrix=function(){return this._renderMatrix},t.getRootNode=function(){return this._rootNode},t.getRotationMatrix=function(){return this._rotMatrix},t.getScaleMatrix=function(){return this._scaleMatrix},t.getSvgParser=function(){if(!this._svgParser){var t=this._svgParser=hi(),i=this;if(this.svgPath){this.on("svgPath",function(e,n){t.parse(n),t.makePathAbsolute(),t.fitPathInto(i.w(),i.h())}),this.on("w",function(){t.fitPathInto(i.w(),i.h())}),this.on("h",function(){t.fitPathInto(i.w(),i.h())});var e;(e=this.svgPath())&&(t.parse(e),t.makePathAbsolute(),t.fitPathInto(i.w(),i.h()))}}return this._svgParser},t.getTransformMatrix=function(){return this._transMatrix},t.getViewMatrix=function(t){return this._viewMatrix||(this._viewMatrix={}),this._viewMatrix[t.localId()]},t.getX=function(){return this.getTransformMatrix().m30()},t.getY=function(){return this.getTransformMatrix().m31()},t.groupResizeHandler=function(t,i,e){var n=this;e=e||{};var o,a,s;e.i||(e.i=0),e.j||(e.j=0),this.listenDragEventsFor(t,function(){var t=n._groupDelegate;if(t){var r=n._groupDisplay.getCamera();n.projectToCamera(r);var h=n.getViewMatrix(r),f=h.projectVector({x:e.i*n.w(),y:e.j*n.h(),z:0,w:1}),c=(t.activeItemsBB(n._groupDisplay.getCamera()),f.x),l=f.y;s={},t.forActiveItems(function(i){t.forActiveItems(function(t){if(t!=i)for(var e=t;e=e.displayParent();)e==i&&(s[t.localId()]=!0)})}),t.forActiveItems(function(t){t._oldRc={i:t.ri(),j:t.rj()},t.moveRotationCenterToSCoords(c,l,n._groupDisplay)}),t.forActiveItems(function(t){t._grScaleM=t.getScaleMatrix().createCopy()}),e.i||e.j?n.moveRotationCenterTo(e.i||0,e.j||0,i):n.moveRotationCenterTo(0,0,i),o=n._scaleMatrix.createCopy(),a=Math.sqrt(n.w()*n.w()+n.h()*n.h())}},function(t){if(n._groupDelegate)try{var i=1,h=1;n.ri()<1&&(i=1/(1-n.ri())),n.rj()<1&&(h=1/(1-n.rj())),e.j&&(h=-1*h),e.i&&(i=-1*i);var f=t.deltaIn.x*i+n.w(),c=t.deltaIn.y*h+n.h(),l=Math.sqrt(f*f+c*c),u=l/a,d=n._groupDelegate;d&&d.forActiveItems(function(t){if(!s[t.localId()]&&t._grScaleM){var i=r();i.scale(u),i.matMul(t._grScaleM),t._scaleMatrix.copyFrom(i),t.callRender()}});var y=r();y.scale(u),y.matMul(o),n._scaleMatrix.copyFrom(y),n.callRender()}catch(m){}},function(){var t=n._groupDelegate;t&&t.forActiveItems(function(t){t.moveRotationCenterTo(t._oldRc.i,t._oldRc.j,n._groupDisplay)})},i,"groupresize"+e.j+e.i,{noActiveReset:!0})},t.groupRotationHandler=function(t,i){var e,n,o,a,s,h,f=this,c=u(),l=[],d={};this.listenDragEventsFor(t,function(t){var r=f._groupDelegate;if(r){var c=f._groupDisplay.getCamera();f.projectToCamera(c);var u=f.getViewMatrix(c),y=u.projectVector({x:.5*f.w(),y:.5*f.h(),z:0,w:1}),m=y.x,p=y.y;d={},r.forActiveItems(function(t){r.forActiveItems(function(i){if(i!=t)for(var e=i;e=e.displayParent();)e==t&&(d[i.localId()]=!0)})}),r.forActiveItems(function(t){t._oldRc={i:t.ri(),j:t.rj()},t.moveRotationCenterToSCoords(m,p,f._groupDisplay)}),r.forActiveItems(function(t){t._grRotM=t.getRotationMatrix().createCopy()}),o=f.getRotationMatrix().createCopy(),f.moveRotationCenterTo(.5,.5,i),l.length=0,e=t.dv.relx,n=t.dv.rely,a=f.w()*f.ri(),s=f.h()*f.rj(),h=f.getViewMatrix(i.getCamera()).projectVector({x:a,y:s,z:0,w:1})}},function(t){if(f._groupDelegate)try{var i=c.angleBetween({x:t.dv.relx-h.x,y:t.dv.rely-h.y},{x:t.dv.relx+t.dv.dx-h.x,y:t.dv.rely+t.dv.dy-h.y}),e=f._groupDelegate;e&&e.forActiveItems(function(t){if(!d[t.localId()]&&t._grRotM){var e=t._grRotM.createCopy(),n=r();n.rotate({x:0,y:0,z:1},i),e.matMul(n),e.isValidMatrix()&&(t._rotMatrix.copyFrom(e),t.callRender())}});var n=o.createCopy(),a=r();a.rotate({x:0,y:0,z:1},i),n.matMul(a),n.isValidMatrix()&&(f._rotMatrix.copyFrom(n),f.callRender())}catch(s){}},function(){var t=f._groupDelegate;t&&t.forActiveItems(function(t){t.moveRotationCenterTo(t._oldRc.i,t._oldRc.j,f._groupDisplay)})},i,"rotategroup",{noActiveReset:!0})},t.handleRotationCenter=function(t,i){var e,n,r,o=this;return void this.listenDragEventsFor(t,function(){e=o.applyLocalTransform(),n=o.ri(),r=o.rj()},function(t){var i=t.deltaIn.x/o.w(),a=t.deltaIn.y/o.h(),s=n+i,h=r+a,f=o.applyLocalTransform({i:s,j:h}),c=e.projectVector({x:0,y:0,z:0,w:1}),l=f.projectVector({x:0,y:0,z:0,w:1});console.log("The change of X in the projections is ",l.x-c.x);var u=l.x-c.x;diff_y=l.y-c.y,diff_z=l.z-c.z,console.log("diff_x is ",u),console.log("diff_y is ",diff_y),o.ri(n+i),o.rj(r+a);e.projectVector({x:u,y:diff_y,z:diff_z,w:0});o._transMatrix.m30(o._transMatrix.m30()-u),o._transMatrix.m31(o._transMatrix.m31()-diff_y),o._transMatrix.m32(o._transMatrix.m32()-diff_z),o.callRender()},function(){},i);var o,e,n,r},t.hideHandles=function(){var t=this.renderClass();return this._handlesVisible=!1,n?n[t]?(this._handlesVisible=!1,void n[t]._hideHandlesFn(this,this._handleData)):void(this._hideHandlesFn&&(this._handlesVisible=!1,this._hideHandlesFn(this,this._handleData))):void 0},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this._transMatrix=r(),this._scaleMatrix=r(),this._rotMatrix=r(),this._renderMatrix=r(),this._handleData={},t._model&&(t=t._model),this._movementLock||(this._movementLock={}),o||(o=[],_={});var n=this;this._model=t;var a=function(i){n._ext=!1,n._extModelId=t.get("extModelId");var e=_data(i);e.then(function(){n._extModel=e,n._ext=!0;var t=e.localFork();t.then(function(){console.log("External model's source fork "),console.log(e.getData()),console.log("External model's local fork "),console.log(t.getData()),n._ext=!0})})};t.get("remoteChannel")&&t.openChannel(t.get("remoteChannel")).then(function(i){var e=i.channel,n=t.get("remoteId"),r=e._client._ns,o=e._client._idToNs(n,r);return void a(o)}),t.get("extModelId")&&a(t.get("extModelId")),t.on("extModelId",function(t,i){a(i)});var l=function(){t&&t.items&&t.items.on("insert",function(i,e){var n=(_data(t.items.at(e)._docData.__id,null,t._client),ci(t.items.at(e)));setTimeout(function(){_data(t.items.at(e)._docData.__id,null,t._client);n.render()},100)}),n.items={push:function(i){var e=t;if(n._ext&&(e=n._extModel),i._callRender){var r=i._model,o=r.parent();return o&&r.remove(),void e.items.push(r)}e.items.push(i)},forEach:function(i){return n._ext?void n._extModel.items.forEach(function(t){if(t.isFulfilled&&!t.isFulfilled())return void console.log("Unfulfilled item");var e=ci(t);e._extParent=n,e&&i(e)}):void t.items.forEach(function(t){if(t.isFulfilled&&!t.isFulfilled())return void console.log("Unfulfilled item");var e=ci(t);e&&i(e)})},length:function(){return n._ext?n._extModel.items.length():t.items.length()},at:function(i){var e=t;n._ext&&(e=n._extModel);var r=e.items.at(i);if(!r.isFulfilled||r.isFulfilled())return r?ci(r):void 0},indexOf:function(i){var e=t;return n._ext&&(e=n._extModel),"undefined"==typeof i?-1:e.items.indexOf(i._callRender?i.model():i)},item:function(i){var e=t;n._ext&&(e=n._extModel);var r=e.items.at(i);if(!r.isFulfilled||r.isFulfilled())return r?ci(r):void 0}},_||(_={}),_[t.getID()]=n,n._getTransfromFromModel(n,t),n.render()};if(t.isFulfilled()?l():t.then(l),!s){var u=function(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var i=navigator.userAgent,e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=e.exec(i)&&(t=parseFloat(RegExp.$1))}return t};y={shiftDown:!1},"undefined"!=typeof $&&$(document).on("keyup keydown",function(t){y.shiftDown=t.shiftKey}),h={list:[],renderIndex:1},f=[],d=[],c={},i={},p=[];
var n=this,m=1,x=1/60;u()>0?(x=.1,m=1,e().every(x,function(){n._onFrame()})):e().onFrame(function(){n._onFrame()}),s=!0}}),t.isDelegatingEvents=function(t,i){if(this._eventDelegates&&this._eventDelegates[t]){var e=this._eventDelegates[t][i];if(e)return e}},t.listenDragEventsFor=function(t,i,e,n,r,a,s){if(r&&a){var h,f,c,l,u,d,m,p=this;this._beforeRot;var _,x={start:{},delta:{},startIn:{},currIn:{},deltaIn:{},deltaCenter:{},displayPos:{x:0,y:0}},v=document.body.clientWidth/2,g=document.body.clientHeight/2,w=1e3,I=r.id(),s=s||{};if(r){var z=this.getDOMOffset(r.getSurface().getDom());x.displayPos.x=z.x,x.displayPos.y=z.y;var C=r.getSurface();v=C.getWidth()/2,g=C.getHeight()/2}this._dragListeners||(this._dragListeners={}),this._dragListeners[I]||(this._dragListeners[I]={}),this._dragListeners[I][a]||(this._dragListeners[I][a]={}),this._dragListeners[I][a]={},this._dragListeners[I][a]={start:function(t,e){var n=p.getDOMOffset(r.getSurface().getDom());x.displayPos.x=n.x,x.displayPos.y=n.y,w=1e3,e.relx=e.sx-x.displayPos.x,e.rely=e.sy-x.displayPos.y,h=p._transMatrix.m30(),f=p._transMatrix.m31(),c=p._transMatrix.m32();var a=p.getViewMatrix(r.getCamera());l=a.m30(),u=a.m31(),d=a.m32(),m=p.getViewMatrix(r.getCamera()).createCopy().inverse(),s.noActiveReset||(o.forEach(function(t){t.hideHandles()}),y.shiftDown||p.clearActiveItems(),p.addActiveItem(p)),o.forEach(function(t){t.showHandles()}),_=p.getViewMatrix(r.getCamera()).intersectPlane({x:v,y:g,z:w},{x:e.relx+e.dx,y:e.rely+e.dy,z:0}),_&&(x.dv=e,x.o=t,x.startIntersection=_,x.startIn.x=_.x,x.startIn.y=_.y,x.startIn.z=_.z,i(x))},drag:function(t,i){if(_){i.relx=i.sx-x.displayPos.x,i.rely=i.sy-x.displayPos.y,x.dv=i,x.o=t;var n=p._beforeRot.createCopy(),o=r.getCamera(),a=o.getRenderMatrix().createCopy().inverse();a.matMul(n),n=a,n.inverse();var s=p.getViewMatrix(r.getCamera()).intersectPlane({x:v,y:g,z:w},{x:i.relx+i.dx,y:i.rely+i.dy,z:0});if(s){{var l={x:s.x-_.x,y:s.y-_.y,z:s.z-_.z},u=n.projectVector({x:l.x,y:l.y,z:l.z,w:0}),d=m.projectVector({x:l.x,y:l.y,z:l.z,w:0});({x:p.w()*p.ri(),y:p.h()*p.rj(),z:0,w:0})}x.start.x=h,x.start.y=f,x.start.z=c,x.delta.x=u.x,x.delta.y=u.y,x.delta.z=u.z,x.currIn.x=s.x,x.currIn.y=s.y,x.currIn.z=s.z,x.deltaIn.x=d.x,x.deltaIn.y=d.y,x.deltaIn.z=d.z,e(x)}}},end:function(){n()}},t.draggable(function(t,i){var e;return(e=p.delegateEvent(I,a))?void e.start(t,i):void p._dragListeners[I][a].start(t,i)},function(t,i){var e;return(e=p.delegateEvent(I,a))?void e.drag(t,i):void p._dragListeners[I][a].drag(t,i)},function(t,i){var e;return(e=p.delegateEvent(I,a))?void e.end(t,i):void p._dragListeners[I][a].end(t,i)})}},t.localId=function(){return this.__id||(this.__id=this.guid()),this.__id},t.lockMovement=function(t){t=t||{},this._movementLock||(this._movementLock={}),"undefined"!=typeof t.x&&(this._movementLock.x=t.x),this._movementLock.y=t.y},t.matchDomPosition=function(t,i,e){var n=i._index,r=e.indexOf(),o=t.child(n),a=t.child(r);a&&n!=r&&(n>r?a.insertBefore(o):a.insertAfter(o))},t.moveRotationCenterTo=function(t,i,e){var n=this,r=n.applyLocalTransform().createCopy(),o=(n.ri(),n.rj(),t),a=i,s=n.applyLocalTransform({i:o,j:a}),h=e.getCamera(),f=(h.getRenderMatrix(),r.projectVector({x:0,y:0,z:0,w:1})),c=s.projectVector({x:0,y:0,z:0,w:1}),l=c.x-f.x,u=c.y-f.y,d=c.z-f.z;n.ri(t),n.rj(i);r.projectVector({x:l,y:u,z:d,w:0});n._transMatrix.m30(n._transMatrix.m30()-l),n._transMatrix.m31(n._transMatrix.m31()-u),n._transMatrix.m32(n._transMatrix.m32()-d),this.x(n._transMatrix.m30()),this.y(n._transMatrix.m31()),n.callRender()},t.moveRotationCenterToSCoords=function(t,i,e){var n=e.getCamera();this.projectToCamera(n);var r=this.getViewMatrix(n);r=r.inverse();var o=r.projectVector({x:t,y:i,z:0,w:1}),a=o.x/this.w(),s=o.y/this.h();this.moveRotationCenterTo(a,s,e)},t.onActiveChange=function(t){p.push(t)},t.projectDimensionPoints=function(t){this.projectToCamera(t);var i=this.getViewMatrix(t),e=[];return e.push(i.projectVector({x:0,y:0,z:0,w:1})),e.push(i.projectVector({x:this.w(),y:0,z:0,w:1})),e.push(i.projectVector({x:0,y:this.h(),z:0,w:1})),e.push(i.projectVector({x:this.w(),y:this.h(),z:0,w:1})),e},t.projectToCamera=function(t){var i=t.getRenderMatrix().createCopy().inverse(),e=this.getRenderMatrix();i.matMul(e),this._viewMatrix||(this._viewMatrix={}),this._viewMatrix[t.localId()]=i},t.registerCameraFn=function(t,i){c[t]=i},t.registerDisplay=function(t){d||(d=[]),d.indexOf(t)<0&&d.push(t)},t.registerRenderFn=function(t,e){i||(i={}),i[t]=e},t.removeActiveItem=function(t){var i;(i=o.indexOf(t))>=0&&(o.splice(i,1),t.hideHandles())},t.removeFromDisplay=function(t){this._displayList&&(this._displayList[t]=null)},t.render=function(){this.addToRenderList(this)},t.renderDisplayList=function(t){t&&d.forEach(function(i){i.render(t)})},t.renderHandles=function(){},t.resizeableFor=function(t,i,e){var n=this;e=e||{};var o,a;e.i||(e.i=0),e.j||(e.j=0),this.listenDragEventsFor(t,function(){e.i||e.j?n.moveRotationCenterTo(e.i||0,e.j||0,i):n.moveRotationCenterTo(0,0,i),o=n._scaleMatrix.createCopy(),a=Math.sqrt(n.w()*n.w()+n.h()*n.h())},function(t){var i=1,s=1;n.ri()<1&&(i=1/(1-n.ri())),n.rj()<1&&(s=1/(1-n.rj())),e.j&&(s=-1*s),e.i&&(i=-1*i);var h=t.deltaIn.x*i+n.w(),f=t.deltaIn.y*s+n.h(),c=Math.sqrt(h*h+f*f),l=c/a,u=r();u.scale(l),u.matMul(o),n._scaleMatrix.copyFrom(u),n.callRender()},function(){},i,"resize"+e.j+e.i)},t.resizeableHeightFor=function(t,i){var e,n=this;this.listenDragEventsFor(t,function(){n.moveRotationCenterTo(0,0,i),e=n.h()},function(t){var i=1;n.rj()<1&&(i=1/(1-n.rj()));var r=t.deltaIn.y*i+e;n.h(r),n.callRender()},function(){},i,"resizeheight")},t.resizeableWidthFor=function(t,i,e){var n,r=this;e=e||{},e.inverse||(e.inverse=0),this.listenDragEventsFor(t,function(){e&&e.inverse?r.moveRotationCenterTo(1,0,i):r.moveRotationCenterTo(0,0,i),n=r.w()},function(t){var i=1;r.ri()<1&&(i=1/(1-r.ri())),e&&e.inverse&&(i=-1*i);var o=t.deltaIn.x*i+n;r.w(o),r.callRender()},function(){},i,"resizewidth"+e.inverse)},t.rotatableFor=function(t,i){var e,n,o,a,s,h,f=this,c=u();this.listenDragEventsFor(t,function(t){f.moveRotationCenterTo(.5,.5,i),o=f.getRotationMatrix().createCopy(),e=t.dv.relx,n=t.dv.rely,a=f.w()*f.ri(),s=f.h()*f.rj(),h=f.getViewMatrix(i.getCamera()).projectVector({x:a,y:s,z:0,w:1})},function(t){try{var i=c.angleBetween({x:t.dv.relx-h.x,y:t.dv.rely-h.y},{x:t.dv.relx+t.dv.dx-h.x,y:t.dv.rely+t.dv.dy-h.y}),e=o.createCopy(),n=r();n.rotate({x:0,y:0,z:1},i),e.matMul(n),e.isValidMatrix()&&(f._rotMatrix.copyFrom(e),f.callRender())}catch(a){}},function(){},i,"rotate")},t.rotate=function(t,i){this._rotMatrix.rotate(t,i)},t.rotate2D=function(t){var i=Math.PI*t/180;this._rotMatrix.rotate({x:0,y:0,z:1},i)},t.saveTransformUpdates=function(){var t=this;if(!t.isFulfilled||t.isFulfilled()){if(this.x){var i=t.getTransformMatrix(),e=t.x(),n=t.y();(i.m30()!=e||i.m31()!=n)&&(console.log("Saving transformation matrix "),t.x(i.m30()),t.y(i.m31()))}if(this.scaleFactor){var r=t.getScaleMatrix(),o=r.m00();t.scaleFactor()!=o&&t.scaleFactor(o)}var a=t.getRotationMatrix(),s=a.getRotation2D(),h=!1;if(t.rad)t.rad()!=s&&(h=!0);else{var f=t.get("rad");h=f&&f==s?!1:!0}h&&!isNaN(s)&&t.set("rad",s),t.items&&t.items.forEach(function(t){t.saveTransformUpdates&&t.saveTransformUpdates()})}},t.scale=function(t){this._scaleMatrix.scale(t)},t.screenToItemCoords=function(t,i){if(i)var e=i;else var e=this.getRenderMatrix().createCopy().inverse();var n=e.projectVector({x:t.x,y:t.y,z:0,w:1});if("undefined"!=typeof t.dx){var r=e.projectVector({x:t.dx,y:t.dy,z:0,w:0});n.dx=r.x,n.dy=r.y}return n},t.serialize=function(){return this.forChildren(function(t){if(t.x&&t.y){var i=t.getTransformMatrix();t.x(i.m30()),t.y(i.m31())}if(t.scaleFactor){var e=t.getScaleMatrix();t.scaleFactor(e.m00())}}),this._model.toData()},t.setClassHandleRenderers=function(t,i,e){if(n||(n={}),this.isArray(t)){var r=this;return void t.forEach(function(t){r.setClassHandleRenderers(t,i,e)})}n[t]={_showHandlesFn:i,_hideHandlesFn:e}},t.setDebugView=function(t){a=t},t.setGroupDelegate=function(t){this._groupDelegate=t},t.setHandleRenderFns=function(t,i){this._showHandlesFn=t,this._hideHandlesFn=i},t.setPosition=function(t,i,e){var n=this.getTransformMatrix();return this.isObject(t)?(this.setPosition(t.x,t.y,t.z),this):("undefined"!=typeof t&&n.m30(t),"undefined"!=typeof i&&n.m31(i),"undefined"!=typeof e&&n.m32(e),this)},t.setRenderData=function(t){this._renderData=t},t.setRenderFn=function(t){this._renderFn=t},t.setRenderScope=function(t){m=t},t.setRootNode=function(t){this._rootNode=t},t.showHandles=function(){var t=this.renderClass();return this._handlesVisible=!0,n?n[t]?(this._handlesVisible=!0,void n[t]._showHandlesFn(this,this._handleData,this.getActiveCamera())):void(this._showHandlesFn&&(this._handlesVisible=!0,this._showHandlesFn(this,this._handleData,this.getActiveCamera()))):void 0},t.startRootTransform=function(){var t=this.getRenderData(),i=h.renderIndex||1;(!t.lastTransIndex||t.lastTransIndex<i)&&(t.lastTransIndex=i,this.applyTransforms())},t.translate=function(t,i,e){this._transMatrix.translate({x:t,y:i,z:e})},t.ungroupItem=function(){var t,i=this._model.parent();if(i&&(t=i.parent()),t&&t.parent()){if(!t.parent())return;var e=t.parent().parent();if(!e)return;newP=ci(e);var n=newP.getRenderMatrix().createCopy().inverse(),r=(this.getRenderMatrix().createTransformCopy(),this.getRenderMatrix().projectVector({x:this.w()*this.ri(),y:this.h()*this.rj(),z:0,w:1})),o=n.projectVector(r),a=i._rotMatrix.createCopy().matMul(this._rotMatrix),s=i._scaleMatrix.createCopy().matMul(this._scaleMatrix);this._transMatrix.m30(o.x),this._transMatrix.m31(o.y),this._transMatrix.m32(o.z),this._rotMatrix.copyFrom(a),this._scaleMatrix.copyFrom(s),this._model.remove(),newP.items.push(this),this.callRender()}}}(this)},ci=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof ci))return new ci(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=ci._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};ci._classInfo={name:"displayItem"},ci.prototype=new fi,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.displayItem=ci,this.displayItem=ci):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.displayItem=ci:this.displayItem=ci}.call(new Function("return this")());var li=function(){!function(t){t.allowRender=function(t,i){if(this._renderIndex||(this._renderIndex=1),"undefined"!=typeof t){this._doc=t,this._stream=t.pipe(blobStream()),this._renderIndex++,this._waiting=!0;var e=this._stream,n=this;i&&e.on("finish",function(){n._waiting=!1,i.attr({src:e.toBlobURL("application/pdf")})})}return this._renderIndex},t.frameFinish=function(){this._waiting&&this._doc&&(this._doc.end(),this._waiting=!1)},t.getDoc=function(){return this._doc},t.getElem=function(){return this._elem},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,e,n){this._elem=t,this._width=i,this._height=e,this._doc=n,this._renderFns||(this._renderFns={})}),t.isRendering=function(){return this._waiting}}(this)},ui=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof ui))return new ui(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=ui._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};li.prototype=h.prototype,ui._classInfo={name:"surfacePdfKit"},ui.prototype=new li,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.surfacePdfKit=ui,this.surfacePdfKit=ui):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.surfacePdfKit=ui:this.surfacePdfKit=ui}.call(new Function("return this")());var di=function(){!function(t){t._initCode=function(t){var i=t.container;i.addClass("displayView");var e,n=_data({data:{type:"displayItem",isCamera:1,renderClass:"camera",displayWidth:t.width,displayHeight:t.height,x:0,y:0,w:77,h:77,scaleFactor:1,ri:0,rj:0,items:{data:[],__id:this.guid()}},__id:this.guid()});e=t.model?t.model:_data({type:"displayItem",renderClass:"page",x:0,y:0,scaleFactor:1,w:t.width,h:t.height,ri:0,rj:0,items:[],rad:0}),e.then(function(){return n}).then(function(){var r=ci(n),o=ci(e),a=o.w()/t.width;r.scaleFactor(a),r.setRootNode(o),r.applyTransforms();var s=i.div();s.attr({style:"position:relative;"});var h=s.div();h.attr({style:"position:absolute;left:0px;top:0px;"});var f=C(h._dom,t.width||300,t.height||300),c=J();c.initSvg(f);var l=(_(r,f),ti(f.getHoverLayer(),t.width||300,t.height||300));l.svgHandles("box"),l.svgHandles("circle"),l.svgHandles("text"),l.svgHandles("svgpath"),t.handles&&t.handles&&t.handles.forEach(function(t){l.svgHandles(t)}),_(r,l),i.on("width",function(){var t=o.w()/i.width();r.scaleFactor(t),r.applyTransforms(),f._svgElem&&f._svgElem.attr({width:i.width()}),s.width(i.width()),h.width(i.width())}),i.on("height",function(){f._svgElem&&f._svgElem.attr({height:i.height()}),s.height(i.height()),h.height(i.height())}),i.svgSurface=function(){return f},i.rootPage=function(){return o},i.camera=function(){return r},i.createObject=function(t,i){return o.createObject(t,i)},i.trigger("load")})},t._pdfkitRenderers=function(t){t.registerRenderer("circle",{start:function(){},refresh:function(t,i){var e=i.getSurface();if(e.isRendering()){var n=e.getDoc();n.save();var r=t.getViewMatrix(i.getCamera());n.transform(r.m00(),r.m01(),r.m10(),r.m11(),r.m30(),r.m31());var o=Math.min(t.w()/2,t.h()/2);n.circle(o,o,o),n.opacity(t.get("alpha")),n.fill(t.get("bgcolor"),"even-odd"),n.restore()}},end:function(){}}),t.registerRenderer("box",{start:function(){},refresh:function(t,i){var e=i.getSurface();if(e.isRendering()){var n=e.getDoc();n.save();var r=t.getViewMatrix(i.getCamera());n.transform(r.m00(),r.m01(),r.m10(),r.m11(),r.m30(),r.m31()),n.rect(0,0,t.w(),t.h()),n.opacity(t.get("alpha")),n.fill(t.get("bgcolor"),"even-odd"),n.restore()}},end:function(){}}),t.registerRenderer("svgpath",{start:function(){},refresh:function(t,i){var e=i.getSurface();if(e.isRendering()){var n=e.getDoc();n.save();var r=t.getViewMatrix(i.getCamera());n.transform(r.m00(),r.m01(),r.m10(),r.m11(),r.m30(),r.m31());var o=t.svgPath(),a=t.w(),s=t.h(),h=hi();h.parse(o),h.makePathAbsolute(),h.fitPathInto(a,s),n.path(h.svgString()),n.opacity(t.get("alpha")),n.fill(t.get("bgcolor"),"even-odd"),n.restore()}},end:function(){}})},t.basicCamera=function(){var t=_data({data:{type:"displayItem",isCamera:1,renderClass:"camera",displayWidth:800,displayHeight:1e3,x:0,y:0,w:77,h:77,scaleFactor:1,ri:0,rj:0,items:{data:[],__id:this.guid()}},__id:this.guid()});return console.log("initializing the data -part here now..."),t},t.basicData=function(){return{data:{type:"displayItem",renderClass:"book",w:1e3,h:1e3,ri:0,rj:0,items:{data:[{data:{type:"displayItem",renderClass:"page",w:1e3,h:1e3,ri:0,rj:0,items:{data:[],__id:this.guid()},rmatrix:{data:{m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1},__id:this.guid()}},__id:this.guid()}],__id:this.guid()},rmatrix:{data:{m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1},__id:this.guid()}},__id:this.guid()}},t.ePlugin=function(){var t=_e(),i=this;t.extendAll({displayView:function(t,e,n){var r=_e("div");return n=n||{},r.width(t),r.height(e),i._initCode({container:r,width:t,height:e,handles:n.handles,model:n.model}),this.add(r),r}})},t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.initSvgScene=function(t,i){console.log("initSvgScene called "),i=i||{};var e=t.div();e.attr({style:"position:relative;"});var n=e.div();n.attr({style:"position:absolute;left:0px;top:0px;"}),i.width&&t.width(i.width),i.height&&t.height(i.height);var r,o=C(n._dom,i.width||300,i.height||300);i.data?r=i.data:(r=_data(this.basicData()),i.noDemo||r.items.item(0).createObject("circle").bgcolor("#ff77ee").alpha(.8));var a,s,h=this.basicCamera(),f=_promise(),c={display:a,uiDisplay:s,surface:o,camera:h,data:r,initDone:f};return h.then(function(){if(!i.noRenderers){var t=J();t.initSvg(o)}if(h.setRootNode(i.cameraRoot?i.cameraRoot:r.items.item(0)),i.cameraPos&&h.setPosition(i.cameraPos),i.cameraScale&&h.scale(i.cameraScale),h.applyTransforms(),c.display=_(h,o),a=c.display,i.handles){var e=ti(o.getHoverLayer(),i.width||300,i.height||300);e.svgHandles("box"),e.svgHandles("circle"),e.svgHandles("text"),e.svgHandles("svgpath"),i.handleClasses&&i.handleClasses.forEach(function(t){e.svgHandles(t)}),c.uiDisplay=s=_(h,e)}f.resolve(!0)}),c}}(this)},yi=function(t,i,e,n,r,o,a,s){var h,f=this;if(!(f instanceof yi))return new yi(t,i,e,n,r,o,a,s);var c=[t,i,e,n,r,o,a,s];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){h=t.apply(f,c)}),"function"==typeof h){if(h._classInfo.name!=yi._classInfo.name)return new h(t,i,e,n,r,o,a,s)}else if(h)return h;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,c)}):"function"==typeof f.init&&f.init.apply(f,c)};yi._classInfo={name:"displayView"},yi.prototype=new di,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.displayView=yi,this.displayView=yi):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.displayView=yi:this.displayView=yi}.call(new Function("return this")()),"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());